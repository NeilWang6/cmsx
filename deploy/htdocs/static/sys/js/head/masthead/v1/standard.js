FDEV.namespace("FD.sys.head");(function(b,a){a.search={categoriesMap:{product:{url:"http://page.1688.com/buy/index.html",action:"http://s.1688.com/search/offer_search.htm",placeholder:"\u8f93\u5165\u4ea7\u54c1\u540d\u79f0"},company:{url:"http://page.1688.com/cp/cp1.html",action:"http://s.1688.com/search/company_search.htm",placeholder:"\u8f93\u5165\u516c\u53f8\u540d\u79f0\u6216\u5173\u952e\u8bcd"},buy:{url:"http://page.1688.com/cp/cp8.html",action:"http://s.1688.com/search/search.htm",placeholder:"\u8f93\u5165\u4ea7\u54c1\u540d\u79f0"},baike:{url:"http://baike.1688.com/",action:"http://s.1688.com/search/wiki_answer_search.htm",placeholder:"\u8f93\u5165\u95ee\u9898\u5173\u952e\u8bcd"},pifa:{url:"http://pifa.1688.com/",action:"http://s.1688.com/search/business_search.htm",placeholder:"\u8f93\u5165\u4ea7\u54c1\u540d\u79f0"},trust:{url:"http://page.1688.com/trust/safeguard.html",action:"http://trust.china.alibaba.com/athena/trustsearch.html",placeholder:"\u8f93\u5165\u516c\u53f8\u540d\u79f0\u6216\u5173\u952e\u8bcd"},info:{url:"http://info.1688.com/",action:"http://s.1688.com/search/news_search.htm",placeholder:"\u8f93\u5165\u4fe1\u606f\u5173\u952e\u8bcd"},club:{url:"http://club.1688.com/",action:"http://s.1688.com/search/forum_search.htm",placeholder:"\u8f93\u5165\u4fe1\u606f\u5173\u952e\u8bcd"},blog:{url:"http://blog.1688.com/",action:"http://s.1688.com/search/blog_search.htm",placeholder:"\u8f93\u5165\u4fe1\u606f\u5173\u952e\u8bcd"},video:{url:"http://video.1688.com/",action:"http://video.1688.com/video/search/search_list.html",placeholder:"\u8f93\u5165\u4fe1\u606f\u5173\u952e\u8bcd"},end:0},isFocus:0,isExt:0,isSuggest:0,isPlaceholder:function(){return !!("placeholder" in document.createElement("input"))},getIsExt:function(){if(["info","club","blog"].indexOf(this.getCurrentType())>-1){this.isExt=1;this.nodes.ext=this.nodes.current}},getCurrentType:function(){var c=this.nodes.current.getAttribute("data-type").trim();return c},placeholder:function(){var c=this.nodes.input,g=this.nodes.form,i=this,e=this.isPlaceholder(),f=i.getCurrentType(),d;g.setAttribute("action",i.categoriesMap[f]["action"]);if(this.isFocus){c.focus()}else{e?c.setAttribute("placeholder",i.categoriesMap[f]["placeholder"]):h(c)}if(e){return}$E.addListener(c,"focus",function(){clearTimeout(d);if($D.hasClass(this,"placeholder")){this.value="";$D.removeClass(this,"placeholder")}i.isFocus=1});$E.addListener(c,"blur",function(){if(this.value.trim()===""){h(this)}d=setTimeout(function(){i.isFocus=0},200)});function h(j){$D.addClass(j,"placeholder");j.value=i.categoriesMap[i.getCurrentType()]["placeholder"]}},changePlaceholder:function(d){var e=this.categoriesMap[d],f=e.placeholder,c=this.nodes.input;c.setAttribute("placeholder",f);this.nodes.form.setAttribute("action",e.action);if($D.hasClass(c,"placeholder")){c.value=f}if(this.isFocus){c.focus()}},basicChangeCategory:function(){var d=this,c=this.nodes;$E.delegate(this.nodes.basicList,"click",function(h){$E.preventDefault(h);var f=this.parentNode.parentNode,g=f.getAttribute("data-type").trim();if(f===c.current){return}$D.removeClass(c.current,"current");c.current=f;$D.addClass(c.current,"current");d.changePlaceholder(g)},"a")},searchOver:function(){var d=this.nodes.extBox,e,c;$E.addListener(d,"mouseover",function(){clearTimeout(c);var f=this;e=setTimeout(function(){$D.addClass(f,"search-over")},200)});$E.addListener(d,"mouseout",function(){clearTimeout(e);var f=this;c=setTimeout(function(){$D.removeClass(f,"search-over")},200)});$E.addListener("searchMore","click",function(f){$E.preventDefault(f)})},extChangeCategory:function(){this.searchOver();this.getIsExt();var d=this,c=this.nodes;$E.delegate(c.extList,"click",function(h){$E.preventDefault(h);var f=this.parentNode.parentNode,g=f.getAttribute("data-type").trim();if(d.isExt){$D.removeClass(c.current,"current");c.current=f;$D.addClass(c.current,"current");$D.removeClass(c.ext,"current");c.extList.appendChild(c.ext);c.ext=f;c.basicList.appendChild(f)}else{$D.removeClass(c.current,"current");c.current=f;$D.addClass(c.current,"current");c.ext=f;c.basicList.appendChild(c.current);$D.removeClass(c.extBox,"search-over");d.isExt=1}d.changePlaceholder(g)},"a")},checkSubmit:function(){var d=this,c=this.nodes;$E.addListener(c.form,"submit",function(i){var g=c.input.value.trim(),f=d.categoriesMap[d.getCurrentType()],h=!!f.target?f.target:"_blank";if((g!=="")&&(g!==f.placeholder)){this.setAttribute("target",h);if(!!f.tracelog){aliclick(this,"?tracelog="+f.tracelog)}}else{$E.preventDefault(i);if(f.url===b.location.href.split("?")[0]){c.input.focus();return false}FD.common.goTo(f.url,h);return false}})},initSuggest:function(){var d=this,c;$E.addListener(this.nodes.input,"focus",function(){if(!d.isSuggest){$Y.Get.css("http://style.c.aliimg.com/css/sys/head/autocomplete.css");if(typeof FD.widget.AutoComplete==="undefined"){var e="http://style.c.aliimg.com/js/fdevlib/widget/autocomplete/fdev-autocomplete-min.js",g={onSuccess:function(i){c=setTimeout(f,200)}},h=FD.common.request("jsonp",[e],g)}else{f()}d.isSuggest=1}function f(){FD.widget.AutoComplete.init(d.nodes.suggest,{charset:"gb2312",pX:4,pY:17,pW:35,formName:"alisearch",isAnim:false,isShowShut:false})}})},init:function(){this.nodes={form:$("aliSearchForm"),input:$("aliSearchInput"),suggest:$("searchBodyContainer"),basicList:$("searchCategoriesList"),extList:$("moreSearchCategoriesList"),extBox:$$(".search-categories .search-ext")[0],current:$$("#searchCategoriesList .current")[0],ext:null};this.placeholder();this.basicChangeCategory();this.extChangeCategory();this.checkSubmit();this.initSuggest()},end:0};$E.onDOMReady(function(){a.search.init()})})(window,FD.sys.head);
