FD.sys.p4p.Utils.debug(false);(function(G,B){var A=YAHOO.lang,F=YAHOO.util.Dom,C=YAHOO.util.Event;B.P4POfferRecommendedView=function(I,E,D,H){E=FD.sys.p4p.Utils.doFitlerData(E);B.P4POfferRecommendedView.superclass.constructor.call(this,E,D,H);this.result=E;this.oP4PConfig=D;this.oMergedP4PConfig=H;this[I]();FD.sys.p4p.Utils.log(E);FD.sys.p4p.Utils.log(D)};A.extend(B.P4POfferRecommendedView,B.AbstractP4PView);A.augmentObject(B.P4POfferRecommendedView.prototype,{onSuccess:function(){FD.sys.p4p.Utils.log("Success:P4POfferRecommendedView");new B.P4POfferRecommendedRender(this.result,"topRecommended",6)},onFailure:function(){FD.sys.p4p.Utils.log("Failure:P4POfferRecommendedView")},onTimeout:function(){},end:0},true);B.P4POfferRecommendedRender=function(E,H,D){this.maxOfferNum=Math.min(D,E.length);this.data=E;this.root=document.getElementById(H);this.searchtrace="bizlist_search_p4phot_offer";this.searchtrace_more="bizlist_search_p4phot_more";this.searchtrace_p4phere="bizlist_p4phere";this.morePost=[];if(p4pObject.dcatid){this.morePost.push("dcatid="+p4pObject.dcatid)}if(p4pObject.keyword){this.morePost.push("keywords="+p4pObject.keyword)}if(this.morePost.length){this.morePost="?"+this.morePost.join("&")}else{this.morePost=""}if(typeof window.businessPageConfig!="undefined"&&window.businessPageConfig.keywordsGbk==""){this.searchtrace="bizlist_list_p4phot_offer";this.searchtrace_more="bizlist_list_p4phot_more"}if(typeof this.root=="undefined"){return}this.doRender()};A.augmentObject(B.P4POfferRecommendedRender.prototype,{_doRenderHeader:function(){return'<div class="title_v1"><h3>\u70ed\u95e8\u63a8\u8350</h3><a target="_blank"  href="'+B.API_CONFIG.entrance+'" onmousedown="BB.aliclick(this,\'?searchtrace='+this.searchtrace_p4phere+"')\">\u6211\u4e5f\u8981\u51fa\u73b0\u5728\u8fd9\u91cc</a></div>"},_doRenderFooter:function(){return'<div class="more"><a href="http://page.1688.com/html/p4p/landingpage.html'+this.morePost+'" target="_blank" onmousedown="BB.aliclick(this,\'?searchtrace='+this.searchtrace_more+"')\">\u66f4\u591a\u70ed\u95e8\u63a8\u8350&gt;&gt;</a></div>"},_doRenderItem:function(I,D){var E=FD.sys.p4p.Utils;var H='<li class="img_offer" '+(D+1==this.maxOfferNum?'style="margin-right:0;"':"")+'><div class="imgbox_v1"><a onmousedown="FD.sys.p4p.Utils.p4pTagClick(\''+I.RESOURCEID+"','"+I.REDKEY+"','819032_1008');BB.aliclick(this,'?searchtrace="+this.searchtrace+'\')" href="'+I.EURL+'" target="_blank"><img src="'+I.OFFERIMGURL.replace(".summ",".220x220")+'" onload="if(this.width>this.height){this.width=150}else{this.height=150}"/></a></div><h3 class="summary"><a onmousedown="FD.sys.p4p.Utils.p4pTagClick(\''+I.RESOURCEID+"','"+I.REDKEY+"','819032_1008');BB.aliclick(this,'?searchtrace="+this.searchtrace+'\')" href="'+I.EURL+'" target="_blank">'+(function(){var J=I.TITLE.lenB();if(J>52){return E.doRed(E.doSubstringAo(E.doReplace(I.TITLE),48,2),I.REDKEY)}else{return E.doRed(I.TITLE,I.REDKEY)}})()+'</a></h3><p class="price">'+this._doRenderPrice(I)+this._doRenderQuantityBegin(I)+this._doRenderWangWang(I,D)+"</p></li>";return H},_doRenderQuantityBegin:function(E){var D=FD.sys.p4p.Utils;if(E.OFFERPRICE==" "){return""}else{if(E.QUANTITYBEGIN.length>4){return'<b title="'+E.QUANTITYBEGIN+'">'+D.doSubstringAo(E.QUANTITYBEGIN,2)+"..."+E.PRICEUNIT+"\u8d77\u6279</b>"}else{return"<b>"+E.QUANTITYBEGIN+E.PRICEUNIT+"\u8d77\u6279</b>"}}},_doRenderPrice:function(H){var D=FD.sys.p4p.Utils;if(H.OFFERPRICE==" "){return"<em>\u4ef7\u683c\u9762\u8bae</em>"}var E=H.OFFERPRICE.split("/")[0].split("."),J=E[0];if(E.length==1){return'<em title="'+J+'">&yen;'+D.doSubstringAo(J,7)+"...</em>"}else{var I=E[1].substr(0,2);if(J.length==5){return'<em title="'+E.join(".")+'">&yen;'+J+"."+I.substr(0,1)+"</em>"}else{if(J.length>5){return'<em title="'+E.join(".")+'">&yen;'+J.substr(0,5)+"...</em>"}else{return'<em title="'+E.join(".")+'">&yen;'+J+"."+I+"</em>"}}}},_doRenderWangWang:function(E,D){return'<span class="p4p-ww"><a class="iconAlitalk" alitalk="{id:\''+E.MEMBERID+'\'}" href="#" onclick="FD.sys.p4p.Utils.p4pClick(\''+E.EURL+"')\" onmousedown=\"FD.sys.p4p.Utils.p4pTraceEnquiryClick({toId:'"+E.MEMBERID+"',offerId:'"+E.RESOURCEID+"',source:'1'});BB.aliclick(this,'?searchtrace="+this.searchtrace+'\')" target="_self">&nbsp;</a></span>'},_doRenderContent:function(E){var D='<ul class="content_v1" id="J_p4p_items">'+(function(J){var I="";for(var H=0;H<J.maxOfferNum;H++){I+=J._doRenderItem(E[H],H)}return I})(this)+"</ul>";return D},doRender:function(){this.root.innerHTML=""+this._doRenderHeader()+this._doRenderContent(this.data)+this._doRenderFooter();new FD.widget.Alitalk(FYS("a[alitalk]","J_p4p_items"),{onRemote:function(){switch(this.opt.online){case 0:case 2:case 6:default:this.innerHTML="";this.title="";break;case 1:this.innerHTML="";this.title="";break;case 4:case 5:this.innerHTML="";this.title="";break}},webWW:function(){window.open("http://alitalk.1688.com/","_blank")}})}});B.getP4POfferRecommended=function(){FD.sys.p4p.Ao(window.p4pObject).use(FD.sys.p4p.P4POfferRecommendedView)}})(window,FD.sys.p4p);
