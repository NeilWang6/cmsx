(function(a){a.moduleManager.register("essential",function(){var j=this,q=a.globals,o=j.moduleManager,f=j.tools,c=j.config,d=o.require("cookieProcessor"),p=o.require("spm"),g=o.require("recorder"),l=o.require("ua"),m=q.customize,i=function(){var s,t=d.get("__cn_logon__")==="true";return t},n=function(){var s=q.win.dmtrack_c;if(!s||s==="{-}"){return{}}s=s.substring(1,s.length-1).replace(/ali_resin_trace=/,"");return f.parseParam(s,"|")},e=function(){try{var u=f.getReferrer(),v=f.random(),s=m.acookieAdditional||{},t={cache:v,pre:u};g.sendEssentialInfo(c.acookieSever,{},f.combineJson(t,s))}catch(w){f.sendErrorInfo(w,"acookie")}},b=function(){var v=l.extraBrowser,s=v.name+v.ver.toFixed(1),t=l.system.name,u=s+"|"+t+"|"+l.resolution+"|"+l.language;return u},k=function(x){var v=m.needCookies,u=c.needDefaultCookies,s,t,w="-";if(f.isArray(u)&&v!=undefined){u=u.concat(v)}s=u.length;while(s--){t=u[s];w=d.get(t)||"-";x[t]=w}},h=function(){var x=encodeURI(f.getReferrer()),v=d.getSubCookies("ali_apache_track")||{},u=c.logSeverOne,w=n(),t=d.getSubCookies("aliBeacon_bcookie")||{},s=encodeURI(q.doc.location.href);if(c.isSetCookieToAcookie){e()}k(v);if(c.isCheckLogin&&w.c_signed==undefined){w.c_signed=i()?1:0}f.combineJson(w,t,true);d.remove("aliBeacon_bcookie");g.sendEssentialInfo(u,{p:"{"+c.siteNo+"}",u:"{"+f.trimHttpStr(s)+"}",m:"{GET}",s:"{200}",r:"{"+x+"}",a:"{"+f.combineParam(v,{},"|")+"}",b:"{-}",c:"{"+f.combineParam(w,t,"|",true)+"}"},{pageid:f.randomPageId(),sys:b()})},r=function(){if(!f.sampling()){return}try{var s=d.get("sync_cookie");if(!s||s!=="yes"){g.send(c.changeServer,"")}h();p.init()}catch(t){f.sendErrorInfo(t,"essential")}};return{init:r}},true)})(MAGNETO);
