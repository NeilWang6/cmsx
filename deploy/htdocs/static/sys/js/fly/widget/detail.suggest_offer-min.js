FD.sys.fly.Utils.debug(true);(function(e,b){var a=YAHOO.lang,d=YAHOO.util.Dom,c=YAHOO.util.Event;b.DetailSuggestOfferView=function(i,h,g,f){this.isHoldOfferView=b.DetailSuggestOfferView.superclass.constructor.call(this,h,g,f,true);this.result=h;this.oFlyConfig=g;this.oMergedFlyConfig=f;this.rate="";this.currencyCnName="";if($("rate")&&$("currencyCnName")){this.rate=parseFloat($("rate").value);this.currencyCnName=$("currencyCnName").value}this.isTopDomain=false;if($("isTopDomain")){this.isTopDomain=Boolean($("isTopDomain").value)}this.topDomainDetailURL="";if(this.isTopDomain===true&&$("topDomainDetailURL")){this.topDomainDetailURL=$("topDomainDetailURL").value}this[i]();FD.sys.fly.Utils.log(h);FD.sys.fly.Utils.log(g);FD.sys.fly.Utils.log(f);return this};a.extend(b.DetailSuggestOfferView,b.AbstractFlyView);a.augment(b.DetailSuggestOfferView,b.InterfaceFlyView);a.augmentObject(b.DetailSuggestOfferView.prototype,{onSuccess:function(){FD.sys.fly.Utils.log("Success:DetailSuggestOfferView");this._render();this._isHoldOfferData()},onFailure:function(){FD.sys.fly.Utils.log("Failure:DetailSuggestOfferView");this.oFlyConfig.callback(this.result,false)},onTimeout:function(){},onProgress:function(){},_render:function(){var h=[];h.push(this._renderHead());h.push(this._renderBody());h.push(this._renderFoot());if($(this.oFlyConfig.flyWidgetId)){var i=document.createElement("ul");i.innerHTML=h.join("");$(this.oFlyConfig.flyWidgetId).appendChild(i);$D.removeClass($$("div.de-blockhd","mod-detail-othsupplyinfo"),"hide");$D.removeClass($$("div.de-blockbd","mod-detail-othsupplyinfo"),"hide");$D.setStyle("mod-detail-othsupplyinfo","display","block");this.oFlyConfig.callback(this.result,true);var g="#"+this.oFlyConfig.flyWidgetId+" div.iphoto";$E.on($$(g),"mouseover",function(){$D.addClass(this,"iover")});$E.on($$(g),"mouseout",function(){$D.removeClass(this,"iover")});var f=$$("a",this.oFlyConfig.flyWidgetId);YAHOO.detail.util.batchClick(f,"data-dydmt")}},_renderHead:function(){return""},_renderBody:function(){var f=[];f.push(this._renderOfferList(this.result.data));return f.join("")},_renderOfferList:function(g){var k=[];var j=parseInt(this.oFlyConfig.count)||10;for(var h=0,f=g.length;h<f&&h<j;h++){k.push(this._renderOfferItem(g[h],h))}return k.join("")},_renderOfferItem:function(h,g){var f=[];f.push("<li>");f.push(this._renderOfferPhoto(h));f.push(this._renderOfferTitle(h));f.push(this._renderOfferPrice(h));f.push("</li>");return f.join("")},_renderOfferPrice:function(i){var f=parseFloat(i.rmbPrice);if(f===0&&Boolean(i.ETC)===false){return'<p class="no-price">\u4ef7\u683c\u9762\u8bae</p>'}if(i.ETC&&Boolean(i.ETC)===true){var g=parseFloat(i.foreignPrice);var h=i.foreignPrice*this.rate;h=h.toFixed(2);return'<p class="p-etc"><b>\u7ea6</b>&yen; <em>'+h+"</em><br/><span>"+g.toFixed(2)+this.currencyCnName+"</span></p>"}return"<p>&yen; <em>"+f.toFixed(2)+"</em><br/></p>"},_renderOfferTitle:function(i){var f=this._getDetailURL(i);var h=i.subject;h=h.replace("<","&#60;");h=h.replace(">","&#62;");var g='<h4><a href="'+f+'" target="_self" onmousedown="FD.sys.fly.Utils.iClick({\'page\':'+this.oFlyConfig.coaseType+",'objectId':'"+i.offerId+"','recId':'"+this.oFlyConfig.recid+"','alg':'"+i.alg+"','objectType':'offer','pid':'"+this.oFlyConfig.pid+'\'})" data-dydmt="recommend1title" title="'+h+'">'+h+"</a></h4>";return g},_renderOfferPhoto:function(g){var f=this._getDetailURL(g);var h='<div class="iphoto"><a href="'+f+'" target="_self" onmousedown="FD.sys.fly.Utils.iClick({\'page\':'+this.oFlyConfig.coaseType+",'objectId':'"+g.offerId+"','recId':'"+this.oFlyConfig.recid+"','alg':'"+g.alg+"','objectType':'offer','pid':'"+this.oFlyConfig.pid+'\'})"  data-dydmt="recommend1pic" title="'+g.subject+'"><img src="'+FD.sys.fly.Utils.getOfferImageURL(g.offerImageUrl,0)+'" onerror="javascript:this.src=\'http://img.china.alibaba.com/news/upload/5002027/48x48_1276134613200.gif\'"></a></div>';return h},_renderFoot:function(){return""},_getDetailURL:function(f){if(this.isTopDomain===true&&this.topDomainDetailURL!=""){return this.topDomainDetailURL.replace(/\{memberId\}/,f.memberId).replace(/\{postCatId\}/,f.categoryId).replace(/\{offerId\}/,f.offerId)}else{return f.offerDetailUrl}},_isHoldOfferData:function(){var h=parseInt(this.oFlyConfig.count)||10,q=this.result.data,f={},g=[],j=(q.length>5?5:q.length);for(var n=0;n<j&&n<h;n++){g.push(q[n].offerId+","+q[n].alg+";")}f.category_id=this.oFlyConfig.catids;f.object_ids=g.join("");this.isHoldOfferView.doRequest(f);if(q.length>5){var p=[],m={},k=true;for(var n=5;n<q.length&&n<h;n++){p.push(q[n].offerId+","+q[n].alg+";")}m.category_id=this.oFlyConfig.catids;m.object_ids=p.join("");FYE.on("J_sugNext","click",function(){if(k){this.isHoldOfferView.doRequest(m);k=false}},this,true)}},end:0},true)})(window,FD.sys.fly);
