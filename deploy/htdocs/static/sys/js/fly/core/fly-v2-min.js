FDEV.namespace("FD.sys.fly");
(function(i){function p(){var a=typeof i.dmtrack_pageid==="undefined"?new Date-0+""+Math.floor(Math.random()*1E3):i.dmtrack_pageid;return i.dmtrack_pageid=a}function q(){var a={},b=i.location.search.substring(1).toLowerCase().split("&"),c,d;c=0;for(d=b.length;c<d;c++){var e=b[c].indexOf("="),h;if(e!==-1){h=b[c].substring(0,e);e=b[c].substring(e+1);a[h]=e}}return a}function r(a){return a&&a.returnCode===0&&k.isArray(a.data)&&a.data.length>0?true:false}var s=i.document,l=Object.prototype.hasOwnProperty,
k=FDEV.lang,j=FD.common,n="http://res.1688.com/fly/recommend.do",m=p(),t={template:"",click:"",apitype:"recommend",onTemplatePre:null,onSuccess:null,onFailure:null},g=function(a,b,c){var d=q(),e=j.lastLoginId,h=j.loginId,f=j.cookie("ali_beacon_id");if(!(this instanceof g))return new g(a,b,c);k.isArray(a)||(a=FYG(a)||s);this.config=j.applyIf(c,t);if(this.config.apitype==="commend")n="http://res.1688.com/fly/commend.do";this.container=a;this.params={};this.params.uid=d.memberid?d.memberid:
h?h:e?e:f?f:-1;this.params.pageid=m;j.applyIf(this.params,b);this._request()};k.augmentObject(g.prototype,{_request:function(){var a=this,b=a.params,c=[],d;for(d in b)if(l.call(b,d))c[c.length]=d+"="+b[d];c=c.join("&");FDEV.util.Get.script(n+"?"+c,{onSuccess:function(){var e=i[b.jsonname]||i.flyResult;r(e)?a._onCallback(e):a._onFailure()},onFailure:function(){a._onFailure()},onTimeout:function(){a._onFailure()},autopurge:true,timeout:1E4})},_onCallback:function(a){var b=a.data,c=this.config,d=this.container;
c.onTemplatePre!==null&&c.onTemplatePre.call(this,a);b.length!==0||(d.innerHTML="<p>\u6682\u65e0\u6570\u636e\uff01</p>");!c.template||(d.innerHTML=FD.widget.Sweet(c.template).applyData(b,this));if(c.click)if(k.isArray(c.click))for(b=c.click.length;b--;)FD.sys.fly[c.click[b].fac_name]=g.iclick(c.click[b]);else FD.sys.fly[c.click.fac_name]=g.iclick(c.click);c.onSuccess!==null&&c.onSuccess.call(this,a)},_onFailure:function(){var a=this.container,b=this.config;if(b.onFailure===null)a.innerHTML='<p>\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7<a target="_self" href="javascript:location.reload();">\u5237\u65b0</a>\u91cd\u8bd5\uff01</p>';
else b.onFailure.call(a)}});g.iclick=function(a){var b=[],c;a=a||{};b[b.length]="st_page_id="+m;for(c in a)if(l.call(a,c)&&c!=="fac_name")b[b.length]=c+"="+a[c];return function(d,e,h){var f=[].concat(b);f[f.length]="objectId="+d;f[f.length]="alg="+e;if(h)f[f.length]="pid="+h;f[f.length]="time="+ +new Date;f="?"+f.join("&");FDEV.util.Get.script("http://stat.1688.com/bt/1688_click.html"+f,{autopurge:true})}};g.fitLength=function(a,b){a=j.unescapeHTML(a);if(a.lenB()>b)a=a.cut(b-3)+"...";return j.escapeHTML(a)};
g.getOfferUrl=function(a){return a.eURL?a.eURL:a.offerDetailUrl};g.getCompanyUrl=function(a){return a.contact};g.getBizrefUrl=function(a){var b=a.domainID;a=a.memberId;if(b!=="")return"http://"+b+".cn.1688.com/athena/bizreflist/"+b+".html";if(a!=="")return"http://"+a+".cn.1688.com/athena/bizreflist/"+a+".html";return""};g.getPrice=function(a){var b=a.rmbPrice;return b!==0&&b!==""?'<span class="fd-cny">&yen;</span><em class="value">'+b+"</em>":a.foreignCurrency!==""?'<span class="fd-cny">\u5916\u5e01</span>':
'<span class="fd-cny"></span>'};g.getImgUrl=function(a,b){a=a.offerImageUrl;b=b||100;if(!a)return b<151?b<101?"http://img.china.alibaba.com/cms/upload/other/nopic-150.png":"http://img.china.alibaba.com/cms/upload/other/nopic-100.png":b<221?"http://img.china.alibaba.com/cms/upload/other/nopic-220.png":"http://img.china.alibaba.com/cms/upload/other/nopic-310.png";return b<151?b<101?a+".summ.jpg":a+".search.jpg":b<221?a+".220x220.jpg":a+".310x310.jpg"};g.p4pSort=function(a){a.sort(function(b,c){return(!b.eURL?
1:0)-(!c.eURL?1:0)})};g.resizeImg=function(a,b,c){a.removeAttribute("width");a.removeAttribute("height");var d;if(i.ActiveXObject){d=new Image;d.src=a.src}else d=a;if(d&&d.width&&d.height&&b){c||(c=b);if(d.width>b||d.height>c){d=d.width/d.height;var e=d>=b/c;a[e?"width":"height"]=e?b:c;if(i.ActiveXObject)a[e?"height":"width"]=(e?b:c)*(e?1/d:d)}}};FD.sys.fly=g;var o=function(a){this.exGroup=[];this.exParams=a||{}};k.augmentObject(o.prototype,{collect:function(a,b){this.exGroup[this.exGroup.length]=
[a,b]},send:function(a,b){var c,d="",e=[];b=b||0;var h=this.exGroup,f=this.exParams,u=h.length>a?a:h.length||h.length;for(a=b;a<u+b;a++)d+=h[a][0]+","+h[a][1]+";";d=d.slice(0,-1);e[e.length]="object_ids="+d;e[e.length]="page_id="+m;for(c in f)if(l.call(f,c))e[e.length]=c+"="+f[c];e[e.length]="time="+ +new Date;e="?"+e.join("&");FDEV.util.Get.script("http://ctr.1688.com/ctr.html"+e,{autopurge:true})}});FD.sys.fly.exposure=o})(window);
