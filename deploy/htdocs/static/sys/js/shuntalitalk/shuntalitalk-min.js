FD.widget.ShuntAlitalk=function(A,B){this._init(A,B)};FD.widget.ShuntAlitalk.defConfig={aliTalkId:"aliservice29",ruleId:"ALITALK_INCALL_ROLE_CTP01",positionId:"Top_Banner",attname:"rel"};FD.widget.ShuntAlitalk.prototype={_init:function(A,B){this.container=FYD.getElementsByClassName(A);this.config=FD.common.applyIf(B||{},FD.widget.ShuntAlitalk.defConfig);this.clicklock=false;this.classfocus=A;FYE.on(this.container,"click",this._clickHandler,this,true)},_clickHandler:function(D,A){if(this.clicklock){return}this.clicklock=true;FYE.preventDefault(D);var C=FYE.getTarget(D);if(!FYD.hasClass(C,this.classfocus)){C=FYD.getAncestorByClassName(C,this.classfocus)}var B=FD.common.parse(FYD.getAttribute(C,this.config.attname));this.config=FD.common.applyIf(B||{},this.config);this._requestHandler()},_requestHandler:function(){var D={};D.memberId=this._getLoginid();D.ruleId=this.config.ruleId;D.positionId=this.config.positionId;var A={};A.id=this.config.aliTalkId;var E=this;var B={onCallback:function(F){E.clicklock=false;if(F.success){switch(F.resultType){case"aliYUrl":FD.common.goTo(F.aliTalkId,"_blank");break;case"alitalkId":default:A.id=F.aliTalkId;FD.widget.Alitalk.talk(A);break}}else{FD.widget.Alitalk.talk(A)}},onTimeout:function(F){E.clicklock=false;FD.widget.Alitalk.talk(A)}};var C=FD.common.request("jsonp","http://athena.1688.com/athena/aliTalkInCall.json",B,D)},_getCookie:function(B){var A=document.cookie.match("(?:^|;)\\s*"+B+"=([^;]*)");return A?unescape(A[1]):""},_getLoginid:function(){return(this._getCookie("__cn_logon__")&&this._getCookie("__cn_logon__")==="true")?this._getCookie("__last_loginid__"):""}};
