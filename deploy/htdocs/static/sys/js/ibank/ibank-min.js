(function(r,o){var j=r.util,w=j.substitute,h=j.ua.ie6,M,u,B,I,f,z,G,E,c,y,F,t,x,v,N,L,A,d,m,K,n,C,l,J,e,a,g,b,s={selected:[],allowMultiple:true,uploadAlbumChange:true,albumCreate:true,albumAuth:true,watermark:false,tab:"album",tabs:["album","upload","online"],limit:10,appendTo:"body",dialog:{center:true,draggable:{handle:"div.handle"},fadeIn:300},token:"",source:"offer_detail",submitText:"插入图片",fileFieldName:"imgFile"},D=FE.test["style.picman.url"]||"http://picman.1688.com",i={},q=[],p;M=function(P){i=r.extend(true,{},s,P);i.tabs=P.tabs||s.tabs;if(!p){M._render();M._init();M._buildEvent();p=true}M._refresh();var S=i.dialog,Q=function(){r.each(i.tabs,function(T,U){f.filter(".tab-"+U).show()});f.filter(".tab-"+i.tab).triggerHandler("click")};f.hide();z.hide();if(S){var O=S.open,R=S.close;S.close=function(){F&&F.flash("destroy");M._clearPool();R&&R(arguments)};S.open=function(){Q();O&&O(arguments)};r.use("ui-dialog"+(S.draggable?",ui-draggable":""),function(){u.dialog(S)})}else{u.appendTo(i.appendTo);Q()}r.each(i.selected,function(T,U){U.id=U.id||"ol-"+r.guid++;M._addToPool(U);G&&M._addToList(U)})};r.extend(M,{albumPuller:"{0}/album/ajax/album_puller_ajax.json",albumList:"{0}/album/ajax/image_detail_list.json",albumCreate:"{0}/album/ajax/createAlbum.json",imgUpload:"{0}/album/ajax/image_upload_ajax.json",_render:function(){u=r("<div>",{id:"sys-ibank",css:{display:"none"}}).html('<div class="ib-wrap"><div class="ib-header handle">                    <h3>插入图片</h3>                    <a class="close" href="javascript:;" title="关闭"></a>                </div>                <div class="ib-content">                    <div class="tabs">                        <div class="tabs-nav">                            <div class="tips">选择您要添加图片的来源</div>                            <ul class="fd-clr"><li class="tab-album">图片管家</li><li class="tab-upload">我的电脑</li><li class="tab-online">网上图片</li></ul>                        </div>						<div class="tabs-content album" style="display:none;"></div>						<div class="tabs-content upload" style="display:none;"></div>						<div class="tabs-content online" style="display:none;"></div>					</div>                    <div class="insert">                        <div class="insert-header">                            <h4>要插入的图片(<em>0</em>/<span></span>)</h4>                            <div class="tips">可通过拖拽调整图片顺序</div>                        </div>                        <div class="insert-content">                            <ul class="insert-pool fd-clr"></ul>                            <ul class="insert-bg fd-clr"></ul>                        </div>                    </div>                </div>                <div class="ib-footer action">                    <a class="button submit" href="javascript:;"><span class="btn-l"><em>插入图片</em></span><span class="btn-r"></span></a>                </div>				<div class="overlay" style="display:none;"></div></div>').appendTo("body")},_init:function(){B=u.children();I=r(">div.overlay",B);f=r("div.tabs-nav li",B);z=r("div.tabs-content",B);m=r("div.insert",B);K=r("ul.insert-pool",B);n=r("ul.insert-bg",B);J=r("<div>").addClass("loading");a=r("a.submit",B);b=r("em",a);M._initImgPool()},_refresh:function(){var P=[];for(var O=0,Q=i.limit;O<Q;O++){P.push("<li>",O+1,"</li>")}n.html(P.join(""));if(i.allowMultiple){B.addClass("ib-multiple")}else{B.removeClass("ib-multiple");i.limit=1}if(i.uploadAlbumChange){l&&l.prop("disabled",false)}else{l&&l.prop("disabled",true)}if(i.albumCreate){t&&t.removeClass("fd-hide")}else{t&&t.addClass("fd-hide")}if(i.albumAuth){x&&x.removeClass("fd-hide")}else{x&&x.addClass("fd-hide")}v&&v.prop("checked",!!i.watermark);b.text(i.submitText);r("h4>span",B).text(i.limit);N&&r(">.d span",N).text(i.limit)},_buildEvent:function(){f.one("click",function(P){var O=f.index(this);if(r(this).hasClass("tab-album")){M._initAlbumTab(O)}else{if(r(this).hasClass("tab-upload")){M._initUploadTab(O)}else{M._initOnlineTab(O)}}}).bind("click",function(P){var O=f.index(this);f.removeClass("current");switch(r.trim(this.className)){case"tab-album":if(r(f[1]).css("display")==="none"){c.width(90).children("span").hide()}else{c.width(245).children("span").show()}break;case"tab-upload":F&&F.flash("destroy");F=null;if(!(F&&F.data("flash"))){M._initUploader(O)}N&&N.removeClass("error success");break;case"tab-online":d&&d.removeClass("error");break}r(this).addClass("current");z.hide();r(z[O]).show()});r("div.ib-header>a",B).click(function(O){O.preventDefault();u.dialog("close")});a.click(function(O){O.preventDefault();i.insert&&i.insert(q);u.dialog("close")})},_renderAlbumTab:function(O){z[O].innerHTML='<div class="album-filter">	                <div class="fd-locate"><select></select></div>	                <div class="tips">请从您的图片管家中点击选择图片</div>	            </div>	            <div class="album-list"><div class="loading"></div></div>	            <div class="album-paging fd-clr" style="visibility:hidden">	                <ul><li class="pagination"></li><li>共<em></em>张</li></ul>	            </div>	            <div class="empty">该相册暂无图片<span><a title="上传" href="javascript:;">请先上传</a>，或选择其他相册<span>。</div>'},_initAlbumTab:function(O){this._renderAlbumTab(O);r.add("data-imgmanager-album",{url:w(M.albumPuller,[D]),dataType:"jsonp",data:{start:1,end:1000,_csrf_token:i.token,source:i.source}});G=r("div.album-list",z[O]);E=r("div.album-paging",z[O]);c=r("div.empty",z[O]);C=r("div.album-filter select",z[O]).bind("change",function(Q){var P=r("option:selected",this);setTimeout(function(){M._loadAlbumList(P.data("album"),1,20)},0)});r("a",c).click(function(P){f.filter(".tab-upload").triggerHandler("click");l.val(C.val())});y=new H(E);G.delegate("a","click",function(P){P.preventDefault(P);this.blur()}).delegate("li","click",function(Q){li=r(this);if(li.hasClass("disabled")){return false}var P=li.data("item");if(li.hasClass("selected")){if(M._delFromPool(P)){li.removeClass("selected")}}else{if(M._addToPool(P)){li.addClass("selected")}else{}}});r.use("data-imgmanager-album",function(P){if(P.result==="success"){M._loadAlbumList(M._refreshCombo(P,C),1,20)}else{}})},_loadAlbumList:function(P,Q,O){E.after(c);if(P.count){r.ajax(w(M.albumList,[D]),{dataType:"jsonp",data:{albumId:P.id,start:Q,end:O,_csrf_token:i.token,source:i.source},beforeSend:function(){E.css("visibility","hidden");G.html(J)},success:function(S){if(S.result==="success"){if(S.dataList.length){var R=r("<ul>").addClass("fd-clr");r.each(S.dataList,function(V,X){var U=new Image(),W=r("<a>",{title:X.title}),Z=r("<div>"),T=r("<li>").data("item",X);U.onload=function(){k(this,64)};U.alt=X.title;if(X.status==="approved"){W.attr("href","javascript:;");U.src=X.src;if(q.some(function(ab,aa){return ab.id==X.id})){T.addClass("selected")}}else{var Y=X.status==="modified"?"verify1":"forbid1";U.src=w("http://img.china.alibaba.com/images/common/icon_v02/{0}.gif",[Y]);T.addClass("disabled")}R.append(T.append(W.append(U)).append(Z))});G.html(R)}y.init({current:Math.ceil(Q/20),total:Math.ceil(P.count/20),count:P.count,click:function(U,T){M._loadAlbumList(P,T*20-19,T*20)}});E.css("visibility","")}}})}else{G.html(c);E.css("visibility","hidden")}},_renderUploadTab:function(O){z[O].innerHTML='<div class="info">如果您不希望上传的图片在相册中公开展示，建议将图片上传到不公开相册中</div>                <div class="upload-form">                    <dl><dt>选择相册：</dt><dd><select></select><a class="album-create" title="创建新相册" href="javascript:;">创建新相册</a></dd></dl>                    <dl><dt>上传图片：</dt><dd class="uploader"></dd></dl>                    <dl><dt></dt><dd><input id="album-watermark" name="album-watermark" type="checkbox" checked="checked"/><label for="album-watermark">添加图片水印</label><a title="设置图片水印" href="http://picman.1688.com/album/print_set.htm" target="_blank">设置图片水印</a></dd></dl>                </div>                <div class="tips">                    <p class="d">提示：您可以上传<span></span>张图片，选择的图片单张大小不超过5MB，支持jpg,jpeg,gif,bmp,png。</p>                    <p class="n"></p>                    <p class="y">上传成功，共 1 张！</p>                </div>				<div class="indicator"><table></table></div>                <div class="create" style="display:none;">                    <div class="ib-header">                        <h5>创建新相册</h5>                        <a class="close" href="javascript:;" title="关闭"></a>                    </div>                    <div class="ib-content">                        <form autocomplete="off">                            <dl><dt>相册名称：</dt><dd><input class="create-field" type="text" name="name" maxlength="25"/></dd></dl>                            <dl class="authority">                                <dt>访问权限：</dt>                                <dd>                                    <input id="album-manager-pub" type="radio" name="isPrivate" value="n" checked="checked"/>                                    <label for="album-manager-pub">公开</label>                                    <input id="album-manager-pwd" type="radio" name="isPrivate" value="y"/>                                    <label for="album-manager-pwd">密码</label>                                    <input id="album-manager-pri" type="radio" name="isPrivate" value="p"/>                                    <label for="album-manager-pri">不公开</label>                                    <img title="不公开的相册不会显示在您的公开相册列表中" alt="" src="http://img.china.alibaba.com/images/common/icon_v03/gif/65.gif"/>                                </dd>                            </dl>                            <div class="create-pwd" style="display:none;">                                <dl><dt>密码：</dt><dd><input class="create-field" type="password" name="password" maxlength="16"/><br/><span>(4~16位非中文字符)</span></dd></dl>                                <dl><dt>确认密码：</dt><dd><input class="create-field" type="password" name="passwordConfirm" maxlength="16"/></dd></dl>                            </div>                            <dl class="error" style="display:none;"><dt></dt><dd></dd></dl>                        </form>                    </div>                    <div class="ib-footer">                        <a class="button insert" href="javascript:;"><span class="btn-l"><em>创建</em></span><span class="btn-r"></span></a>                    </div>                </div>'},_refreshCombo:function(U,P){P=r(P);var Q={"公开":[],"密码访问":[],"不公开":[]};var T=[],O=[],Z=[],W=P.val()||i.albumId,R=P.css("visibility"),V,Y,S=false;P.css("visibility","hidden").empty();r.each(U.dataList,function(aa,ab){if(ab.type==="MY"||ab.type==="CUSTOM"){if(ab["private"]){Q["不公开"].push(ab)}else{if(ab.lock){Q["密码访问"].push(ab)}else{Q["公开"].push(ab)}}}if(!S&&W==ab.id){S=true}});for(var X in Q){if(!Q[X].length){continue}var Y=r("<optgroup>").attr("label",X);r.each(Q[X],function(aa,ab){var ac={value:ab.id,html:ab.title.cut(10,"...")+(ab.remain>0?"":" (已满)"),title:ab.title};if(!ab.remain&&l&&P[0]===l[0]){ac.disabled=true}if(!S&&ab.type==="MY"){ac.selected="selected";V=ab}if(S&&ab.id==W){ac.selected="selected";V=ab}Y.append(r("<option>",ac).data("album",ab))});P.append(Y)}P.css("visibility",R);return V},_initUploadTab:function(V){this._renderUploadTab(V);r.add("data-imgmanager-album",{url:w(M.albumPuller,[D]),data:{start:1,end:500,_csrf_token:i.token,source:i.source},dataType:"jsonp"});var P=r("div.create",z[V]),W=r("form",P),O=r("input:radio",P),X=r("input.create-field",P),S=r("div.create-pwd",P),R=r("a.close",P),U=r("dl.error",P),Q=r(">dd",U),T=r("a.insert",P);t=r("a.album-create",z[V]);x=r("dl.authority",P);v=r("#album-watermark");N=r("div.tips",z[V]);l=r("select",z[V]);r(">.d span",N).text(i.limit);if(!i.uploadAlbumChange){l.prop("disabled",true)}if(!i.albumAuth){x.addClass("fd-hide")}if(!i.watermark){v.prop("checked",false)}r.use("data-imgmanager-album",function(Y){if(Y.result==="success"){M._refreshCombo(Y,l)}else{}});t.bind("click",function(Y){Y.preventDefault();r.use("ui-position",function(){P.fadeIn(300);h&&l.css("visibility","hidden")})});O.click(function(){var Y=O.index(this);if(Y===1){i.allowMultiple||P.css("marginTop","-60px");S.show()}else{i.allowMultiple||P.css("marginTop","0");S.hide()}});R.click(function(Y){Y.preventDefault();P.fadeOut(200,function(){U.hide();X.val("");h&&l.css("visibility","visible")})});T.click(function(Y){Y.preventDefault();if(r(this).hasClass("button-disabled")){return}var Z="";if(!X[0].value.trim()){Z="请输入相册名称！"}else{if(S.css("display")!=="none"){if(!X[1].value){Z="密码不可以为空！"}else{if(X[1].value.length<4){Z="密码必须为4-16位非中文字符！"}else{if(X[1].value!==X[2].value){Z="您两次输入的密码不一致，请重新输入！"}}}}}if(Z){Q.html(Z);U.show();return}r.ajax(w(M.albumCreate,[D]),{dataType:"jsonp",data:r.paramSpecial({name:X[0].value,isPrivate:O.filter(":checked").val(),password:X[1].value,passwordConfirm:X[2].value,_csrf_token:i.token,source:i.source}),beforeSend:function(){T.addClass("button-disabled");U.hide()},success:function(aa){if(aa.result==="success"){M._loadAlbumCombo(undefined,function(ab){l.val(aa.dataList[0].id)});P.fadeOut(200,function(){U.hide();X.val("");h&&l.css("visibility","")})}else{this.error()}},error:function(){Q.html("网络繁忙，请稍后刷新页面再试！");U.show()},complete:function(){T.removeClass("button-disabled")}})});if(!i.albumCreate){t.addClass("fd-hide")}},_subStringImgName:function(Q){if(Q.length<13){return Q}var P=/(.+).(jpg|jpeg|gif|bmp|png)$/i;var O=P.exec(Q);if(O){return O[1].substring(0,7)+"..."+O[2]}return Q.substring(0,13)},_showProgress:function(Q,P){var O=Q[0].rows;r.each(P,function(V,U){var W=O[V],T=r(">td.name",W),S=T.next(),R=S.next();r.log(U.name+"_"+U.status);switch(U.status){case"ready":default:S.progressbar("value",5);R.html("准备上传！");break;case"done":case"not_transfered":case"refused":if(M._isFileSuccess(U)){S.progressbar("value",100);R.html("上传成功！")}else{R.html("上传失败！");R.css({color:"#F00"})}break;case"cs_processing":S.progressbar("value",Number(U.msg)*100);R.html("正在上传！");break}})},_isFileSuccess:function(O){if(O&&O.status==="done"){var P=r.parseJSON(O.msg);if(P){if(P.result==="success"){return true}}}return false},_initUploader:function(O){r.use("ui-flash-uploader2,ui-progressbar,ui-position",function(){var U=r(">.n",N),T=r(">.y",N),P=r(">div.indicator",z[O]),R=r(">table",P),Q=true,S=[];F=r("dd.uploader",z[O]).flash({width:160,height:32,module:"uploader2",flashvars:{buttonSkin:"http://img.china.alibaba.com/images/common/icon_v02/upload1.png"}}).bind("swfReady.flash",function(V){r.log("swfReady");if(i.allowMultiple){F.flash("enableMultiple")}else{F.flash("disableMultiple")}if(q.length<i.limit){r(this).flash("enable")}else{r(this).flash("disable")}}).bind("mousedown.flash",function(){var W=r("option:selected",l),Y=W.data("album"),X=Math.min(Y.remain,i.limit-q.length);try{r(this).flash("setFileCountLimit",X)}catch(V){}}).bind("fileSelect.flash",function(W,X){r.log("fileSelect~");N.removeClass("success").removeClass("error");var V=r(this).flash("getFileStatuses");R.empty();r.each(V,function(ac,ab){var ad=R[0].insertRow(-1),aa=ad.insertCell(0),Z=ad.insertCell(1),Y=ad.insertCell(2);r(aa).addClass("name").html(M._subStringImgName(ab.name));r(Z).addClass("progress").progressbar();r(Y).addClass("status")});h&&l.css("visibility","hidden");I.after(P).show();P.position({of:B,my:"center center",at:"center center"});r(this).flash("uploadAll",w(M.imgUpload,[D]),{drawTxt:v.prop("checked"),albumId:l.val(),_csrf_token:i.token,source:i.source},i.fileFieldName);M._showProgress(R,V);r(this).triggerHandler("progress")}).bind("processProgress.flash",function(){var V=r(this).flash("getFileStatuses");M._showProgress(R,V)}).bind("finish.flash",function(){r.log("finish.flash");r(this).triggerHandler("progress");var Y=0;var V=false;var X=r(this).flash("getFileStatuses");M._showProgress(R,X);var ab=[];var ac={TYPEERR:[],SIZE_OVERFLOW:[],REACH_MAX_FILE_COUNT:[],MAXIMGPERALBUMEXCEEDED:[],COMPRESS_FAIL:[],DEFAULT:[]};var Z={TYPEERR:"抱歉，图片格式不对，系统支持 jpg, jpeg, gif, bmp, png。",IMGTYPEERR:"抱歉，图片格式不对，系统支持 jpg, jpeg, gif, bmp, png。",UNKNOWNERROR:"抱歉，图片格式不对，系统支持 jpg, jpeg, gif, bmp, png。",SIZE_OVERFLOW:"抱歉，图片因大于5MB。",REACH_MAX_FILE_COUNT:"抱歉，由于超过上传数量限制。",MAXIMGPERALBUMEXCEEDED:"抱歉，您的相册已满。",COMPRESS_FAIL:"抱歉，因图片无法压缩到2M以内，导致上传失败，请压缩后再上传。",DEFAULT:"抱歉，因网络繁忙。"};function aa(ad,ae){if(ad.length){ab.push(ae+"以下"+ad.length+"张图片无法上传:"+ad.join(","))}}r.each(X,function(ae,ad){function ag(ah){var ai;switch(ah.status){case"refused":return ah.msg;case"transferFail":return"UNKNOWNERROR";case"transferCanceled":return"CANCELED";case"not_transfered":return"COMPRESS_FAIL";case"done":ai=r.parseJSON(ah.msg);if(ai){if(ai.result==="fail"){return ai.errMsg[0]}}break}}if(M._isFileSuccess(ad)){Y++}else{var af=ag(ad);V=true;switch((af).toUpperCase()){case"TYPEERR":case"IMGTYPEERR":case"UNKNOWNERROR":ac.TYPEERR.push(M._subStringImgName(ad.name));break;case"SIZE_OVERFLOW":case"REACH_MAX_FILE_COUNT":case"MAXIMGPERALBUMEXCEEDED":case"COMPRESS_FAIL":ac[(af).toUpperCase()].push(M._subStringImgName(ad.name));break;default:ac.DEFAULT.push(M._subStringImgName(ad.name));break}}});if(V){r.each(ac,function(ae,ad){aa(ad,Z[ae])});U.html(ab.join("<br>"));N.removeClass("success").addClass("error")}if(!V&&Q&&Y){N.removeClass("error").addClass("success");T.text("上传成功，共 "+Y+" 张！")}r(this).flash("clear");if(Y){M._loadAlbumCombo(function(ad){if(C.val()===l.val()){M._loadAlbumList(ad,1,20)}},W)}else{W()}Q=true;function W(){I.hide();R.empty();P.appendTo(z[O]);h&&l.css("visibility","")}}).bind("transferCompleteData.flash",function(W,X){r.log("transferCompleteData");var V=X.file.msg||{};if(typeof V==="string"){V=r.parseJSON(V)}if(V.result==="success"){if(M._addToPool({id:r.makeArray(V.dataList)[0],src:r.makeArray(V.miniImgUrls)[0],bigSrc:r.makeArray(V.imgUrls)[0]})===i.limit){r(this).flash("disable")}else{r(this).triggerHandler("progress")}return}})})},_loadAlbumCombo:function(O,P){O=O||r.noop;P=P||r.noop;r.use("data-imgmanager-album",function(Q){if(Q.result==="success"){C&&O(M._refreshCombo(Q,C));l&&P(M._refreshCombo(Q,l))}},{})},_renderOnlineTab:function(O){z[O].innerHTML='<div class="online-adder">                    <dl>						<dt>输入网上图片地址</dt>						<dd><input type="text" maxlength="120" value="http://"/><div>抱歉，图片地址不对！</div></dd>                        <dd><a class="button" href="javascript:;"><span class="btn-l"><em>添加</em></span><span class="btn-r"></span></a></dd>                    </dl>                </div>                <div class="tips">                    <p>提示：此处插入的图片显示会受到图片存放地址的影响。<a title="如何获取网上图片的地址" href="http://baike.1688.com/doc/view-d2942066.html" target="_blank">如何获取网上图片的地址</a></p>                </div>'},_initOnlineTab:function(P){this._renderOnlineTab(P);L=r("input",z[P]);d=L.parent();A=r("a.button",z[P]);var O=L.next();L.keydown(function(Q){if(Q.keyCode===13){A.triggerHandler("click")}});A.click(function(T){T.preventDefault();if(r(this).hasClass("button-disabled")){return}d.removeClass("error");var R=L.val().trim(),S=true;if(!R){O.html("请输入图片地址！");S=false}else{if(!/^(https?|ftp):\/\/.+/.test(R)){O.html("抱歉，图片地址不对！");S=false}}if(S){var Q=new Image();Q.onload=function(){d.removeClass("error");if(M._addToPool({id:"ol-"+r.guid++,src:R,bigSrc:R})===i.limit){L.prop("disabled",true)}else{A.removeClass("button-disabled")}L.val("")};Q.onerror=function(){O.html("抱歉，该图片无法加载！");d.addClass("error");if(q.length<i.limit){A.removeClass("button-disabled")}};A.addClass("button-disabled");Q.src=R}else{d.addClass("error")}});if(q.length===i.limit){L.prop("disabled",true);A.addClass("button-disabled")}},_initImgPool:function(){e=r("h4>em",B);r.use("ui-portlets",function(){K.portlets({items:">li",placeholder:"ui-state-highlight",orientation:"horizontal",axis:"x",revert:150,scroll:false,opacity:0.5,stop:function(R,Q){var O=r(">li",K).index(Q.currentItem),P=Q.currentItem.data("item"),S=q.indexOf(P);q.splice(O,0,q.splice(S,1)[0])}})});K.delegate("a","click",function(Q){Q.preventDefault();var O=r(this).closest("li"),P=O.data("item");G&&M._delFromList(P);M._delFromPool(P)})},_addToPool:function(S){var P=r(">li",K).length;if(P===i.limit){return false}var O=r("<li>").data("item",S),T=r("<div>",{title:S.title||""}),R=new Image(),Q=r("<a>",{title:"点击删除该图片",href:"javascript:;"});R.onload=function(){k(this,64)};R.alt="";R.src=S.src;K.append(O.append(T.append(R)).append(Q));q.push(S);P++;if(P===i.limit){F&&F.flash("disable");if(d){L.prop("disabled",true);A.addClass("button-disabled")}}e.html(P);if(!i.allowMultiple){setTimeout(function(){a.triggerHandler("click")},50)}return P},_delFromPool:function(R){var P=false,Q=r(">li",K),O=Q.length;Q.each(function(T,S){S=r(S);var U=S.data("item");if(U.id==R.id){S.animate({width:0},150,function(){S.remove()});q.remove(U);P=true;return false}});if(O===i.limit&&P){F&&F.flash("enable");if(d){L.prop("disabled",false);A.removeClass("button-disabled")}}e.html(q.length);return P},_clearPool:function(){q=[];r("li",G).removeClass("selected");K.empty();e.html(0);F&&F.flash("enable");if(d){L.prop("disabled",false);A.removeClass("button-disabled")}},_delFromList:function(P){var O=false;r("li",G).each(function(R,Q){Q=r(Q);var S=Q.data("item");if(S.id==P.id){Q.removeClass("selected");O=true;return false}});return O},_addToList:function(P){var O=false;r("li",G).each(function(R,Q){Q=r(Q);var S=Q.data("item");if(S.id===P.id){Q.addClass("selected");O=true;return false}});return O}});function k(P,O,R){if(P.width){if(!R){R=O}if(P.width>O||P.height>R){var S=P.width/P.height,Q=S>=O/R;P[Q?"width":"height"]=Q?O:R;P[Q?"height":"width"]=(Q?O:R)*(Q?1/S:S)}}}function H(O){var P=this;P.pagination=r("li.pagination",O);P.counter=r("em",O);P.pagination.delegate("a","click",function(Q){Q.preventDefault(Q);this.href&&P.options.click&&P.options.click.call(this,Q,this.href.match(/#(\d+)/)[1]*1)})}H.prototype={init:function(P){var O=this;O.options=P||{};O.counter.html(P.count);O.render(P.current,P.total)},render:function(T,R){T=T||1;R=R||1;if(T<1){T=1}if(R<1){R=1}if(T>R){T=R}var P=[],S,Q;if(T===1){P.push('<a class="pre-disabled"> </a>');P.push('<a class="current">1</a>')}else{P.push('<a class="pre" href="#'+(T-1)+'"> </a>');P.push('<a href="#1">1</a>')}if(R>1){if(T>4&&R>7){P.push('<a class="omit">...</a>')}if(T<3){S=0;Q=(T===1?5:4);if(T+Q>R){Q=R-T}}else{if(T===3){S=1;Q=3;if(T+Q>R){Q=R-T}}else{S=2;Q=2;if(T+Q>R){Q=R-T}S=4-Q;if(T+3>R){S++}if(T-S<2){S=T-2}}}for(var O=S;0<O;O--){P.push('<a href="#'+(T-O)+'">'+(T-O)+"</a>")}if(T>1){P.push('<a class="current">'+T+"</a>")}for(var O=1;O<Q+1;O++){P.push('<a href="#'+(T+O)+'">'+(T+O)+"</a>")}if(T+Q<R-1){P.push('<a class="omit">...</a>');P.push('<a href="#'+R+'">'+R+"</a>")}if(T+Q===R-1){P.push('<a href="#'+R+'">'+R+"</a>")}}if(T===R){P.push('<a class="next-disabled">下一页</a>')}else{P.push('<a class="next" href="#'+(T+1)+'">下一页</a>')}this.pagination.html(P.join(""))}};o.iBank=M})(jQuery,FE.sys);