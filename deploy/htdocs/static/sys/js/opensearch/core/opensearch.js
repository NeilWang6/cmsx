FDEV.namespace("FD.sys.opensearch");(function(b,a){a.ApiConfig={searchApi:"http://service.s.1688.com/rpc/offer/getRemoteOffer.xhtml",defaultParams:{fromId:"opensearch",search_type:"offer",type:"sale",keywords:"",imageFlag:1,onlyAlipay:1,onlineStatus:"all",onlyWithPrice:true,distinctField:"userid",distinctCount:1,mlr:true,pagesize:5},end:0};a.Util={log:function(d,c){if(b.console!==undefined&&console.info){console[c&&console[c]?c:"info"](d);}},toFixed:function(d,c){var e=Math.pow(10,c||0);d*=e;d=d.toFixed(c);d=Math.round(d);d/=e;return d.toFixed(c);},resizeImage:function(d,c,g){d.removeAttribute("width");d.removeAttribute("height");var e;if(window.ActiveXObject){e=new Image();e.src=d.src;}else{e=d;}if(e&&e.width&&e.height&&c){if(!g){g=c;}if(e.width>c||e.height>g){var i=e.width/e.height,f=i>=c/g;if(window.ActiveXObject){d=d.style;}d[f?"width":"height"]=f?c:g;if(window.ActiveXObject){d[f?"height":"width"]=(f?c:g)*(f?1/i:i);}}}},getOfferDetailUrl:function(c){if(c!==""){return"http://detail.1688.com/buyer/offerdetail/"+c+".html";}},getOfferSearchUrl:function(j,n,d,g,o){var i="",m="",e="",h="",l="";if(typeof j==="string"&&j!==""){i="k-"+j;}if(typeof n==="string"&&n!==""){e=n.split(" ");if(e.length>=1){m="c-"+e[0]+"_";}}if(typeof g==="boolean"&&g){h="entrance-etc_";}if(typeof o==="string"&&o!==""){l="_f-"+o.replace("_",":");}if(i!==""||m!==""){return"http://s.1688.com/business/"+i+"_"+m+"p-1"+l+"_fromOfferId-"+d+"_"+h+"n-y.html";}else{return this.getOfferDetailUrl(d);}},getOfferUrl:function(j,h,f,e,i,g,d){var c;if(h||j==="detail"){c=this.getOfferDetailUrl(i);}else{c=this.getOfferSearchUrl(f,e,i,g,d);}return c;},getOfferImgUrl:function(g,d,c){var d=d||0,h=["http://img.china.alibaba.com/images/sys/lock/100x100.jpg","http://img.china.alibaba.com/images/sys/lock/150x150.jpg","http://img.china.alibaba.com/images/sys/lock/220x220.jpg","http://img.china.alibaba.com/images/sys/lock/310x310.jpg"],f=["http://img.china.alibaba.com/images/cn/p4p/nopic_100x100.gif","http://img.china.alibaba.com/images/cn/market/trade/list/070423/nopic150.gif","http://img.china.alibaba.com/images/cn/market/trade/list/070423/nopic150.gif","http://img.china.alibaba.com/images/cn/market/trade/list/070423/nopic150.gif"];if(c&&c!==2){return h[d];}if(g===""){return f[d];}if(g&&g.indexOf("http")){g="http://"+g;}var e=[".summ.jpg",".search.jpg",".220x220.jpg",".310x310.jpg"];return g+e[d];},getCompanyUrl:function(c,d,e){if(c==="1"||c==="2"){if(d!==""){return"http://"+d+".cn.1688.com";}else{return"http://"+e+".cn.1688.com";}}else{return"http://company.1688.com/athena/"+e+".html";}},tracelog:function(c){function d(e,g){if(typeof window.dmtrack!="undefined"){dmtrack.clickstat(e,g);}else{var f=new Date();if(document.images){(new Image).src=e+g+"&time="+f.getTime();}}return true;}return d("http://stat.1688.com/tracelog/click.html","?tracelog="+c);},end:0};a.theme={};a.OpenSearchModule=function(d,c,e){this.openSearchConfig=FD.common.applyIf(d,a.ApiConfig.defaultParams);this.appCustomize=c;this.openSearchApp=e=function(i,h,g,f){this.result=h||{};this.openSearchConfig=g;this.appCustomize=f;this.appCustomize.imgType=(this.appCustomize.imgType&&(this.appCustomize.imgType-0)<4)?(this.appCustomize.imgType-0):1;if(this.appCustomize.theme&&a.theme[this.appCustomize.theme]&&typeof a.theme[this.appCustomize.theme]==="object"){if(this.appCustomize.containerId&&$(this.appCustomize.containerId)){this[i]();}else{a.Util.log("missing containerId!","warn");}}else{a.Util.log("missing theme: "+this.appCustomize.theme+"!","warn");}};this.load();this.openSearchApp.prototype={onSuccess:function(){if(!FDEV.lang.isObject(this.result)){return;}if(this.result.searchResultCount!==0&&this.result.searchResultList.length!==0){a.theme[this.appCustomize.theme].getHtmlRoot(this.result,this.appCustomize,this.openSearchConfig);}else{this.onFailure();}},onFailure:function(){a.theme[this.appCustomize.theme].getErrorTips(this.appCustomize,"failure");},onTimeout:function(){a.theme[this.appCustomize.theme].getErrorTips(this.appCustomize,"timeout");},onProgress:function(){a.theme[this.appCustomize.theme].getErrorTips(this.appCustomize,"progress");},end:0};};a.OpenSearchModule.prototype={load:function(){var c=this.getLoadUrl();var e={onSuccess:this.onSuccess,onFailure:this.onFailure,onTimeout:this.onTimeout,onProgress:this.onProgress,scope:this,timeout:5000,charset:"gb2312",data:{}};var d=FDEV.util.Get.script(c,e);},getLoadUrl:function(){var c=a.ApiConfig.searchApi+"?"+this.getParamsString();return c;},getParamsString:function(){var c=this.openSearchConfig,e=[];for(var d in c){e.push(d+"="+c[d]);}return e.join("&");},onSuccess:function(){var c={};c=window[this.openSearchConfig.returnJsonObjectName];this.toDo("onSuccess",c);},onFailure:function(){this.toDo("onFailure",{});},onTimeout:function(){this.toDo("onTimeout",{});},onProgress:function(){this.toDo("onProgress",{});},toDo:function(d,c){new this.openSearchApp(d,c,this.openSearchConfig,this.appCustomize);},end:0};a.Ao=function(d,c){var e=this;if(!(e instanceof arguments.callee)){return new arguments.callee(d,c);}return{use:function(f){new a.OpenSearchModule(d,c,f);},end:0};};})(window,FD.sys.opensearch);