if(!FE.sys.Alibar){jQuery.namespace("FE.sys.Alibar");(function(d,i,f){var s,c,m=false,e=d.util,j=d.noop,l=FE.util,g=d.util.ua.ie6;var o={urlInit:function(){d("li.account-signout>a",s).attr("href",(n("style.loginchinahttp.url")||"http://login.1688.com")+"/member/signout.htm");d("li.account-signin>a",s).attr("href",(n("style.loginchina.url")||"https://login.1688.com")+"/member/signin.htm?Done="+encodeURIComponent(location.href))},loginfoInit:function(){function t(){var v=d("span.account-id",s),z="http://me.1688.com/",w;d("li.account-msg, li.account-signin, li.account-signup, li.account-signout",s).addClass("fd-hide");u();B({source:["b2b","taobao"]}).always(function(){if(l.IsLogin()){d("li.account-msg, li.account-signout",s).removeClass("fd-hide");w=d("<a>",{href:z,html:A(l.LoginId()),target:"_blank",title:l.LoginId()});if(d("li.vipInfoBox",s).length){w.addClass("nav-arrow")}v.html(w);window.aliclick&&w.mousedown(x);y();d.ajax("http://work.1688.com/home/unReadMsgCount.htm",{dataType:"jsonp",success:function(G){var F=d("li.account-msg",s),D=F.children(),E;D.children().remove();if(G.success&&G.count>0){E=d("<span>",{html:G.count>99?"99+":G.count});D.append(E);D.attr("title","\u4f60\u6709\u65b0\u6d88\u606f");window.aliclick&&E.mousedown(function(){aliclick(this,"?tracelog=cn_alibar_msg")})}else{D.attr("title","\u67e5\u770b\u4f60\u7684\u6d88\u606f")}}})}else{d("li.account-signin, li.account-signup",s).removeClass("fd-hide");if(l.LastLoginId()){w=d("<a>",{href:z,html:A(l.LastLoginId()),target:"_blank",title:l.LastLoginId()}).mousedown(x);v.html(w);window.aliclick&&w.mousedown(x)}else{v.html("\u6b22\u8fce\u6765\u5230\u963f\u91cc\u5df4\u5df4");d("li.account-msg span",s).remove()}}});function A(D){var E="";if(D.length<=11){return D}else{if(escape(D).indexOf("%u")!==-1){E=D.substring(0,10)+"..."}else{E=D.length>14?D.substring(0,13)+"...":D}return E}}function y(){d.use("util-cookie",function(){var G=d.util.cookie("__rn_refer_login_id__");var D=l.getLastMemberId();var F=d.util.cookie("__cn_logon_id__");var H=d.util.cookie("__rn_alert__");var E=d.util.cookie("__rn_second_alert__");var I="http://member.1688.com/member/rename/rename_cookie_sync.do?memberId="+D;if(!G||G!==F){d.ajax(I,{dataType:"jsonp",success:function(J){if(J.success){H=d.util.cookie("__rn_alert__");E=d.util.cookie("__rn_second_alert__");if(E&&E==="true"){p()}else{if(H&&H==="true"){C()}else{k();h()}}}else{k();h()}},error:function(){}})}else{if(E&&E==="true"){p()}else{if(H&&H==="true"){C()}}}})}function B(E){if("updateLoginInfo" in l){return l.updateLoginInfo(E)}else{var D=new d.Deferred;D.resolve();return D}}function x(){aliclick(this,"?tracelog=cn_alibar_id")}function C(){var D="http://member.1688.com/member/prename/pre_name.htm?req_from=alibar";var E=('<div class="tips-content"><div class="tip-text add"><p style="color:#444;">\u4e3a\u4e86\u8ba9\u5ba2\u6237\u5feb\u901f\u8bb0\u4f4f\u60a8\uff0c\u60a8\u9700\u8981\uff1a</p><div class="modify_nick_btn"><a href="'+D+'">\u7acb\u5373\u4fee\u6539\u7528\u6237\u540d</a></div></div><div class="tips-close"></div></div><div class="tips-top"></div>');c.html(E);r(false)}function u(){d("a.modify-nick",s).remove()}}t();i.refresh=t},dropdownInit:function(){d("li.extra",s).mouseenter(function(){g&&d(this).addClass("nav-hover");d(this).prev().addClass("nav-hover-prev")}).mouseleave(function(){g&&d(this).removeClass("nav-hover");d(this).prev().removeClass("nav-hover-prev")})},vipInfoInit:function(){var x=d("li.vipInfoBox",s);var B=null;var t=null;var y='<p class="reLoginRemind">\u60a8\u7684\u767b\u5f55\u72b6\u6001\u5df2\u5931\u6548,<a href="http://login.1688.com/member/signin.htm" target="_self">\u8bf7\u91cd\u65b0\u767b\u5f55</a></p>';var z='<p class="subAccountRemind">\u60a8\u597d\uff01\u60a8\u5f53\u524d\u767b\u9646\u4e86\u4f1a\u5458\u5b50\u8d26\u53f7  <a href="http://login.1688.com/member/signout.htm" target="_self">\u9000\u51fa</a></p>';if(!x.length){return}var v=0;x.mouseenter(function(){B=d(this);if(!l.IsLogin()||v){return}a();u();d.ajax({url:"http://vip.1688.com/club/club_info_json.do",dataType:"jsonp",success:function(D){if(D.success!==true){if(D.data.errorMsg==="NOT_LOGIN"){C();d("li.vipInfoBox div.nav-content",s).html(y);v=1}else{if(D.data.errorMsg==="SUB_ACCOUNT"){C();d("li.vipInfoBox div.nav-content",s).html(z);v=1}}return}A(D.data);C();v=1},error:function(){}})});if(l.IsLogin()){x.hover(function(){d(".modify_nick",s).addClass("fd-hide");if(t){clearTimeout(t);t=null}setTimeout(function(){B.addClass("infoHover")},100)},function(){t=setTimeout(function(){B.removeClass("infoHover");t=null},400)})}function A(G){var D=l.getLastMemberId();D=D?D:"";var E='<div class="levelWrapper fd-clr">                                    <div class="memberPhoto">                                        <a href="http://me.1688.com" target="_blank">                                            <img src="<%= this.userImg %>" alt="" onerror="<%= this.error %>"/>                                        </a>                                    </div>                                    <div class="level">                                        <p class="account">                                            <a class="accountManage" href="http://work.1688.com/home/page/index.htm#app=accountmanagement&menu=&channel=" target="_blank">\u8d26\u53f7\u7ba1\u7406</a>                                            <span class="sep">|</span>                                            <a class="signout" href="http://login.1688.com/member/signout.htm" data-trace="cn_alibar_quit" title="\u9000\u51fa">\u9000\u51fa</a>                                        </p>                                        <p class="supplyLevel fd-clr">                                            <% if( typeof $data.saleRate !== "undefined" ) { %>                                                <span class="title">\u4f9b\u5e94\u7b49\u7ea7:</span>                                                <a class="levelImg" data-trace="alibar_supplier_rank" href="<%= $data.saleRate.targetUrl %>" target="_blank" title="<%= $data.saleRate.tips %>">                                                    <img src="<%= $data.saleRate.logoUrl %>" alt=""/>                                                </a>                                            <% } else if(typeof $data.saleRate === "undefined" && typeof $data.buyRate === "undefined" && $data.medals.length === 0 ) { %>                                                <a class="vipClub" data-trace="alibar_vip_club" href="http://vip.1688.com" target="_blank">\u53bb\u4f1a\u5458\u4ff1\u4e50\u90e8\u901b\u901b</a>                                            <% } %>                                        </p>                                        <p class="purchaseLevel fd-clr">                                            <% if( typeof $data.buyRate !== "undefined" ) { %>                                                <span class="title">\u91c7\u8d2d\u7b49\u7ea7:</span>                                                <a class="levelImg" data-trace="alibar_buyers_rank" href="<%= $data.buyRate.targetUrl %>" target="_blank" title="<%= $data.buyRate.tips %>">                                                    <img src="<%= $data.buyRate.logoUrl %>" alt=""/>                                                </a>                                            <% } else if(typeof $data.saleRate === "undefined" && typeof $data.buyRate === "undefined" && $data.medals.length === 0 ) { %>                                                <a class="newComer" data-trace="alibar_vip_noviciate" href="http://page.1688.com/html/service/aliguide/seller_user_guide.html" target="_blank">\u65b0\u624b\u5e2e\u52a9\u4e2d\u5fc3</a>                                            <% } %>                                        </p>                                    </div>                                </div>                                <% if( $data.medals.length ) { %>                                    <div class="medalWrapper fd-clr">                                        <% for ( var i = 0; i < $data.medals.length; i++ ) { %>                                            <a class="medal" href="<%= $data.medals[i].targetUrl %>" data-trace="alibar_medal_rank" title="<%= $data.medals[i].tips %>">                                                <img src="<%= $data.medals[i].logoUrl %>" alt=""/>                                            </a>                                        <% } %>                                    </div>                                <% } %>';var F=w(D);var H={userImg:F,error:"this.src='http://img.china.alibaba.com/cms/upload/2012/137/253/352731_936034060.png';this.onerror=null;"};d.use("web-sweet",function(){var I;var J=d("li.vipInfoBox div.nav-content",s);I=FE.util.sweet(E).applyData(G,H);J.html(I)})}function w(I){var H=I.substring(0,1),F=I.substring(1,2),E=I.substring(2,3),G=I.substring(3,4);var D=H+"/"+F+"/"+E+"/"+G+"/";return"http://img.china.alibaba.com/club/upload/pic/user/"+D+I+"_s.jpeg"}function u(){var D=d("div.nav-content",x);D.addClass("alibar-loading");D.css("height",60)}function C(){var D=d("div.nav-content",x);D.removeClass("alibar-loading");D.css("height","auto")}},purchaselistInit:function(){var z=d("li.topnav-purchaselist",s);if(!z.length){return}var A=d("div.nav-title",z),u=d("em",A),w=d("div.nav-content",z),y=w.children(".product-list"),x=w.children(".purchase-info"),v=d("p",y);z.mouseenter(function(){window.aliclick&&aliclick(this,"?tracelog=cn_alibar_purchaselist_hover");G()});y.on("click","a.delete",function(K){K.preventDefault();var I=d(this).closest("dl"),J=I.data("item"),H="offer";d.ajax({url:(n("style.luna.url")||"http://order.1688.com")+"/order/purchase/ajax/delete_from_purchase_list_no_csrf_auth.jsx",dataType:"script",cache:false,data:{returnType:"jsonp",batchDel:[H,J.goodsID,J.specId].join()},success:function(){if(window.delFromPurchaseListResult&&delFromPurchaseListResult.success){m=false;G();d(document).triggerHandler("delitem.alibar");window.delFromPurchaseListResult=f}},error:function(){m=false;G()}})});function G(){if(m){return}t();d.ajax({url:(n("style.luna.url")||"http://order.1688.com")+"/order/purchase/ajax/quick_purchase_list.jsx",dataType:"jsonp",success:function(I){if(I.success!==true){return}F();y.children("h3, dl").remove();x.children("p").remove();var H=I.totalKind||I.sumOfKind;u.text(H);C(H);if(H){D(I.data);E(I)}if(I.totalKind&&y.find("dl").length){y.prepend("<h3>\u6700\u8fd1\u52a0\u5165\u7684\u8d27\u54c1\uff1a</h3>")}m=true},error:function(){F()}})}function B(){d.ajax({url:(n("style.luna.url")||"http://order.1688.com")+"/order/purchase/ajax/quick_purchase_list_count.jsx",dataType:"jsonp",success:function(I){if(I.success!==true){return}var H=I.sumOfKind;u.text(H);C(H);m=false}})}function C(H){if(H){z.addClass("topnav-purchaselist-stock")}else{z.removeClass("topnav-purchaselist-stock")}}function D(H){d.each(H,function(M,O){if(M>4){return false}var I="";var P;if(O.specInfos&&O.specInfos.length){P=[];d.each(O.specInfos,function(Q,R){P.push('<span title="');P.push(R.specName);P.push("\uff1a");P.push(R.specValue);P.push('" class="specItem');if(Q===O.specInfos.length-1){P.push(" lastItem")}P.push('">');P.push(R.specName);P.push("\uff1a");P.push(R.specValue);P.push("</span>")});I=['<dd class="specInfos">',P.join(""),"</dd>"].join("")}var K=d("<dl>"),N=e.escapeHTML(O.goodsName,true),L=["<dt>",'<a title="',N,'" target="_blank" href="',O.imgLinkUrl,'" data-trace="cn_alibar_purchaselist_offerdetail"></a>',"</dt>",'<dd class="title">','<a title="',N,'" target="_blank" href="',O.imgLinkUrl,'" data-trace="cn_alibar_purchaselist_offerdetail">',e.escapeHTML(O.goodsName.cut(23,"...")),"</a>","</dd>",I,'<dd class="price">',"&yen;<em>",O.goodsPrice,"</em>\u5143&nbsp;\u00d7&nbsp;<span>",O.goodsCount,"</span>","</dd>",'<dd class="action"><a class="delete" title="\u5220\u9664" href="#">\u5220\u9664</a></dd>'],J=new Image();d(J).one("load",function(){if(this.width&&this.height){var Q,S;S=Q=50;if(this.width>Q||this.height>S){var T=this.width/this.height,R=T>=Q/S;J[R?"width":"height"]=R?Q:S;if(g){J[R?"height":"width"]=(R?Q:S)*(R?1/T:T)}}}});J.alt=O.goodsName;J.src=O.imgUrl;K.html(L.join("")).data("item",O);y.append(K.html(L.join("")).data("item",O));d(">dt>a",K).append(J)})}function E(J){var I=d("<p>"),H=[];if(J.remainKind){H=['\u8fdb\u8d27\u5355\u8fd8\u5269\u4f59\u8d27\u54c1\uff1a<span class="orange">',J.remainKind,"</span>\u79cd\uff08",J.remainCount,"\u4ef6\uff09"]}else{if(J.sumOfKind){H=["\u5171\u8ba1<span>",J.sumOfKind,"</span>\u79cd\u8d27\u54c1\uff08",J.sumOfAcount,"\u4ef6\uff09<br/>\u8d27\u54c1\u5408\u8ba1\uff1a<em>",J.sumOfPrice.toFixed(2),"</em>\u5143"]}}x.prepend(I.html(H.join("")))}function t(){y.addClass("alibar-loading");var H=0;if(y.children("dl").length){H=y.height()}else{H=60}y.css("height",H);v.addClass("fd-hide")}function F(){y.removeClass("alibar-loading");y.css("height","auto");v.removeClass("fd-hide")}B();i.purchaselistRefresh=B},tpInit:function(){d("li.topnav-tp",s).one("mouseenter",function(){var t=this;d.use("web-alitalk-shunt",function(){FE.util.alitalk.shunt(d("a.order-online",t),{attr:"alitalk-shunt",ruleId:"ALITALK_INCALL_ROLE_CTP01"})})})},traceInit:function(){window.aliclick&&d("#alibar-v4").on("mousedown","a[data-trace]",function(){aliclick(this,"?tracelog="+d(this).data("trace"))})},sessionKeeper:function(){d(window).one("load",function(){d.getScript("http://style.c.aliimg.com/sys/js/session-keeper/session-keeper.js")})}};function k(){var t="show_inter_tips";if(q()){return}if(d.util.subCookie(t)!="false"){r(true);d.use("util-cookie",function(){d(".tips-close",c).on("click",function(){d.util.subCookie(t,"false")})})}}function h(){if(q()){return}d(window).on("userSwitchedToTB",function(t,u){d(".tip-text",c).html(d.util.substitute('<p>\u60a8\u6b63\u5728\u4f7f\u7528 <em>\u6dd8\u5b9d\u5e10\u53f7 {nick}</em> \u8bbf\u95ee\u963f\u91cc\u5df4\u5df4\u4e2d\u56fd\u7ad9\uff0c\u60a8\u53ef\u4ee5\u201c<a href="http://login.1688.com/member/logout.htm">\u9000\u51fa</a>\u201d\u540e\u91cd\u65b0\u767b\u5f55\u5176\u4ed6\u963f\u91cc\u5df4\u5df4\u5e10\u53f7\u3002\u7f51\u5e97\u8fdb\u8d27\u53ef\u4ee5\u6765\u201c<a href="http://tao.1688.com/?tracelog=hipage_home_alibar" target="_blank">\u6dd8\u8d27\u6e90</a>\u201d\u901b\u901b\u54e6~<a class="i-know" href="#i-know">\u6211\u77e5\u9053\u4e86</a></p>',u));r(true)});c.on("click","a.i-know",function(t){t.preventDefault();a()});d(window).one("load",function(){d.getScript("http://style.c.aliimg.com/sys/js/common/user-switching-notify.js")})}function p(){var t="http://member.1688.com/member/prename/second_pre_name.htm?req_from=2nd_prename",u="http://work.1688.com/home/page/index.htm#app=accountmanagement&menu=&channel=",v='\u60a8\u73b0\u5728\u6709\u4fee\u6539\u767b\u5f55\u540d\u7684\u673a\u4f1a\uff0c\u60a8\u53ef\u4ee5\uff1a<a href="'+t+'" target="_blank">\u7acb\u5373\u4fee\u6539</a>\u6216\u4e4b\u540e\u5728<a href="'+u+'" target="_blank">\u6211\u7684\u963f\u91cc-\u8d26\u53f7\u7ba1\u7406</a>\u4e2d\u4fee\u6539';d(".tip-text",c).html(v);r(false)}function n(t){return FE.test&&FE.test[t]}function q(){var t=/d.1688.com|d.1688.com/g;if(t.test(document.location.host)){return true}return false}function r(t,u){if(u){d(".tip-text",c).html(u)}c.show().offset(b());if(t){c.delay(10000).fadeOut(100)}d(".tips-close",c).on("click",function(v){v.preventDefault();a()});d(window).resize(function(){setTimeout(function(){c.offset(b())},25)})}function b(){var u=d(".account-id",s).offset();var t=s;return{left:u.left-5,top:t.offset().top+t.height()}}function a(){c.hide()}i.refresh=i.refresh||j;i.purchaselistRefresh=i.purchaselistRefresh||j;i.showTip=r;i.hideTip=a;d(function(){s=s||d("#alibar-v4");c=d(".alibar-tips",s);if(s.length){for(var t in o){o[t]()}}})})(jQuery,FE.sys.Alibar)};
