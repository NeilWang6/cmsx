/*
* PopUpSignIn Window
* @author yongming.baoym@alibaba-inc.com
* @version 20100907
*/
FD.widget.PopUpSignIn=function(a){this.init(a)};FD.widget.PopUpSignIn.defConfig={customCls:"mod-popsignin-win",id:"mod-popsignin-win",checkCodeUrl:"http://checkcode.china.alibaba.com/service/checkcode?size=small",freeRegisterUrl:"http://exodus.1688.com/member/join/common_join.htm",getPwdUlr:"http://exodus.1688.com/member/retrieve_password.htm",requestUrl:"http://exodus.1688.com/member/CommonPopSignin.htm",requestUrl2:"http://exodus.1688.com/member/CommonGetSessionId.htm",requestUrl3:"http://exodus.1688.com/member/mobiletrade/is_history_mobile.htm",requestMethod:"JSONP",tips:{memberIdLabel:"登录名/电子邮箱/手机号码",blankMemberId:"请输入您的登录名/电子邮箱/手机号码。",blankPassword:"请输入您的密码。",blankCheckCode:"请输入您的验证码。",signFail:{FAIL_USERNAME:"您输入的帐号不存在，请重新输入。",FAIL_PASSWORD:"您输入的密码不正确，请重新输入。",checkCodeError:"您输入的验证码不正确，请重新输入。",FAIL_DISABLED:'您的帐号无法正常使用，可能是以下原因之一：<br/>1.涉嫌大量发布广告信息<a href="http://im.alisoft.com/security.html?flag=1#nogo" target="_blank">查看详情</a><br/>2.违反会员协议或阿里巴巴相关交易规则<br/>3.帐号已注销<br/><input type="button" class="goback" value="返回" />'},unknownSignFail:"系统繁忙，请稍后再试。"}};FD.widget.PopUpSignIn.prototype={init:function(a){this.config=FD.common.applyIf(a||{},FD.widget.PopUpSignIn.defConfig);this.__init()},__init:function(){var a=this.__getHTMLTemplate(),g=this.config,l=$E,m=$D,f=l.isIE,p=this,b=document.createElement("div");b.className="mod-popsignin-win";g.id?b.id=g.id:"";g.customCls?m.addClass(b,g.customCls):"";b.innerHTML=a;FD.widget.block(b,{showOverlay:false,iframe:false,fixed:g.fixed,focusInput:false});if(g.iframe&&6==l.isIE){var n=/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",k=document.createElement("iframe"),j=$$(".over-lay",b,true);k.src=n;m.setStyle(k,"position","absolute");m.setStyle(k,"margin","0");m.setStyle(k,"padding","0");m.setStyle(k,"width","100%");m.setStyle(k,"height","100%");m.setStyle(k,"border","0 none");m.insertBefore(k,j)}if(p.__getCookie("JSESSIONID")){p.__initEvent(b)}else{FD.common.request("JSONP",g.requestUrl2,{onCallback:function(d){p.__initEvent(b)},onSuccess:function(d){d.purge()},onTimeout:function(d){d.purge()},onFailure:function(d){d.purge()}})}var o=showAnim=null,i=function(){},c=function(){m.addClass(b,"hide");p.__reset();g.afterClose&&g.afterClose.apply(p)},h=function(){m.removeClass(b,"hide");g.afterShow&&g.afterShow.apply(p)};this.getWin=function(){return b.parentNode};this.abortRequest=function(){p.__isAborted=true};(function(){if(f){p.closeWin=function(){c()};p.showWin=function(){h()}}else{if(FYU.Anim){o=new FYU.Anim(b,{opacity:{to:0}},0.2,FYU.Easing.easeOut);o.onComplete.subscribe(c);showAnim=new FYU.Anim(b,{opacity:{to:1}},0.2,FYU.Easing.easeOut)}else{o={animate:function(){c()}};showAnim={init:i,onComplete:{subscribe:i},animate:function(){h()}}}p.closeWin=function(){o.animate()};p.showWin=function(d){if(!m.hasClass(b,"hide")){return}m.removeClass(b,"hide");showAnim.init(b,{opacity:{to:d?d:1}},0.2,FYU.Easing.easeOut);showAnim.onComplete.subscribe(h);showAnim.animate()}}})()},__initEvent:function(i){var k=$$,u=$E,v=$D,q=this,x=this.config,s=k(".close",i,true),b=k("input[name=memberid]",i,true),n=k("input[name=mtype]",i),a=k("input[name=password]",i,true),l=k("input[name=checkcode]",i,true),w=k(".checkcodeimg",i,true),f=k(".refreshcode",i,true),p=k(".getpasswordurl",i,true),m=k(".registerurl",i,true),c=k(".tip-line",i,true),j=k(".loading-line",i,true),r=k(".success-line",i,true),t=k(".submit-line",i,true),o=k("input[name=submitbtn]",i,true),h=false;w.src=x.checkCodeUrl+"&sessionID="+encodeURIComponent(q.__getCookie("JSESSIONID")||"");v.removeClass(w,"hide");v.removeClass(f,"hide");p.href=x.getPwdUlr;m.href=x.freeRegisterUrl;this.__resetTypeStatus=function(){h=false;var d=k(".memidlabel",i);v.addClass(d,"hide");v.removeClass(b,"sinput");n[0].checked=true};var g=function(){if(/^[1][3|5|8]\d{9}$/.test(b.value.trim())){FD.common.request("JSONP",x.requestUrl3,{onCallback:function(d){if(d.isHistoryMobile=="true"){h=true;var e=k(".memidlabel",i);v.removeClass(e,"hide");v.addClass(b,"sinput");n[0].checked=true}else{q.__resetTypeStatus()}},onSuccess:function(d){d.purge()},onTimeout:function(d){d.purge()},onFailure:function(d){d.purge()}},{paramA:b.value.trim()})}else{q.__resetTypeStatus()}};if(q.__getCookie("__last_loginid__")){b.value=q.__getCookie("__last_loginid__");g();a.focus()}else{b.focus()}u.on(b,"blur",function(){g()});this.__showTip=function(d){v.removeClass([c,t],"hide");v.addClass(j,"hide");c.innerHTML=d;o.disabled=b.disabled=a.disabled=l.disabled=false;v.removeClass(o,"disabled");return q};this.__showLoading=function(){v.addClass([c,t],"hide");v.removeClass(j,"hide");o.disabled=b.disabled=a.disabled=l.disabled=true;v.addClass(o,"disabled");return q};this.__showSuccessTip=function(d){if(!d){window.location.reload()}else{}return q};this.__reset=function(){v.addClass(c,"hide");v.addClass(r,"hide");v.addClass(j,"hide");v.removeClass(t,"hide");o.disabled=b.disabled=a.disabled=l.disabled=false;v.removeClass(o,"disabled");return q};this.__checkBeforeSubmit=function(){var d=q.config.tips;if(!b.value.trim()){q.__showTip(d.blankMemberId);b.select();return false}if(!a.value.trim()){q.__showTip(d.blankPassword);a.select();return false}if(!l.value.trim()){q.__showTip(d.blankCheckCode);l.select();return false}return true};s.hideFocus=true;u.on(i,"click",function(d){u.stopPropagation(d)});u.on(s,"click",function(d){u.preventDefault(d);if(!q.__isRequesting){q.closeWin()}});u.on([b,a,l],"keydown",function(d){if(d.keyCode===13){q.__sendRequest(b.value.trim(),a.value,l.value)}});u.on([f,w],"click",function(d){u.stopEvent(d);q.__refreshCheckCode();setTimeout(function(){l.select()},50)});u.on(o,"click",function(d){u.preventDefault(d);q.__sendRequest(b.value.trim(),a.value,l.value)});u.on(l,"focus",function(){this.select()});if(u.isIE==6||u.isIE==7){u.on([b,a,l],"focus",function(d){v.addClass(this,"focus")});u.on([b,a,l],"blur",function(d){v.removeClass(this,"focus")});u.on(o,"mouseover",function(){v.addClass(this,"over")});u.on(o,"mouseout",function(){v.removeClass(this,"over")})}q.__signCallback=function(d){if(q.__isAborted){return}if(d.ResultSet.status=="success"){if(q.config.signSuccess){q.config.signSuccess.call(q,d)}else{q.__signSuccess()}}else{if(d.ResultSet.status=="fail"){q.__refreshCheckCode();if(q.config.signFail){q.config.signFail.call(q,d)}q.__signFail(d.ResultSet.failType)}else{q.__refreshCheckCode();q.__signFail(q.config.tips.unknownSignFail)}}};this.__signSuccess=function(){window.location.reload()};this.__signFail=function(d){q.__showTip(q.config.tips.signFail[d]||q.config.tips.unknownSignFail);switch(d){case"checkCodeError":l.select();break;case"FAIL_USERNAME":b.select();break;case"FAIL_PASSWORD":a.select();break;case"FAIL_DISABLED":q.__showDisabledInfo();break;default:break}};this.__unknowSignFail=function(){q.__showTip(q.config.tips.unknownSignFail);b.select();q.__refreshCheckCode()};this.__showDisabledInfo=function(){var e=k(".con-wrap",i,true),d=k(".goback",i,true);v.setStyle(e,"visibility","hidden");v.addClass(c,"tip-line2");u.on(d,"click",function(){v.setStyle(e,"visibility","visible");v.removeClass(c,"tip-line2");v.addClass(c,"hide")})};this.__refreshCheckCode=function(){if(q.__isRequesting){return}w.src=w.src+"&r="+Math.random()};this.__getMemberIdType=function(){if(h){for(var e=0,d=n.length;e<d;e++){if(n[e].checked){return n[e].value}}}}},__sendRequest:function(a,d,b){if(!this.__checkBeforeSubmit()||this.__isRequesting){return}this.__isRequesting=true;this.__isAborted=false;this.__showLoading();var c=this,f=c.__getMemberIdType()?{paramA:a,paramB:d,checkCode:b,type:c.__getMemberIdType()}:{paramA:a,paramB:d,checkCode:b},e={onCallback:function(g){c.__isRequesting=false;c.__signCallback(g)},onFailure:function(g){g.purge();c.__isRequesting=false;if(c.__isAborted){return}c.__unknowSignFail()},onTimeout:function(g){g.purge();c.__isRequesting=false;if(c.__isAborted){return}c.__unknowSignFail()},onSuccess:function(g){g.purge();c.__isRequesting=false},autopurge:true};FD.common.request(c.config.requestMethod,c.config.requestUrl,e,f)},__getHTMLTemplate:function(){return'<div class="mod-popsignin-wrap"><div class="over-lay"></div><div class="mod-popsignin-con"><h1><em>会员登录</em><a href="" title="关闭" class="close">close</a></h1><p class="tip-line hide"></p><div class="con-wrap"><p class="top-tip">请使用您在阿里巴巴中国站的会员帐号登录本网站</p><p class="input-line"><em>帐&nbsp;号：</em><input type="text" name="memberid" title="登录名/电子邮箱/手机号码" class="input" maxlength="50" /><label class="memidlabel hide"><input type="radio" name="mtype" checked="checked" value="id" class="mtype">登录名</label><label class="memidlabel hide"><input type="radio" name="mtype" value="mobile" class="mtype">手机</label></p><p class="input-line"><em>密&nbsp;码：</em><input type="password" name="password" class="input" maxlength="20" /><a href="" title="找回密码" target="_blank" class="getpasswordurl" tabindex="-1">找回密码</a></p><p class="code-line"><em>验证码：</em><input type="text" name="checkcode" maxlength="4" /><img src="" class="checkcodeimg hide"><a href="#" title="看不清，换一张" class="refreshcode hide" tabindex="-1">看不清</a></p><p class="success-line hide"></p><p class="loading-line hide"><img src="http://img.china.alibaba.com/images/app/member/widgets/loading.gif" alt="正在为您登录，请稍候..." title="正在为您登录，请稍候..." /><em>正在为您登录，请稍候...</em></p><p class="submit-line"><input type="button" name="submitbtn" class="submit" value="登 录"  /><a href="" class="registerurl" target="_blank">免费注册</a></p></div></div></div>'},__getCookie:function(a){var b=document.cookie.match("(?:^|;)\\s*"+a+"=([^;]*)");return b?unescape(b[1]):""}};