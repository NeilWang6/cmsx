(function($,SYS){var ua=navigator.userAgent,win=window,doc=document,startTime=0,endTime=0,sections=[],sectionMaxImgLoadTime=0,OSInfo=function(){var token=[["Windows NT 5.1","WinXP"],["Windows NT 6.0","WinVista"],["Windows NT 6.1","Win7"],["Windows NT 5.2","Win2003"],["Windows NT 5.0","Win2000"],["Macintosh","Macintosh"],["Windows","WinOther"],["Ubuntu","Ubuntu"],["Linux","Linux"]],ret="Other";for(var i=0;i<token.length;i++)if(ua.indexOf(token[i][0])!=-1){ret=token[i][1];break}return ret}(),UA=function(){var ua=
navigator.userAgent,EMPTY="",MOBILE="mobile",core=EMPTY,shell=EMPTY,m,o={},numberify=function(s){var c=0;return parseFloat(s.replace(/\./g,function(){return c++===0?".":""}))};if((m=ua.match(/AppleWebKit\/([\d.]*)/))&&m[1]){o[core="webkit"]=numberify(m[1]);if((m=ua.match(/Chrome\/([\d.]*)/))&&m[1])o[shell="chrome"]=numberify(m[1]);else if((m=ua.match(/\/([\d.]*) Safari/))&&m[1])o[shell="safari"]=numberify(m[1]);if(/ Mobile\//.test(ua))o[MOBILE]="apple";else if(m=ua.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/))o[MOBILE]=
m[0].toLowerCase()}else if((m=ua.match(/Presto\/([\d.]*)/))&&m[1]){o[core="presto"]=numberify(m[1]);if((m=ua.match(/Opera\/([\d.]*)/))&&m[1]){o[shell="opera"]=numberify(m[1]);if((m=ua.match(/Opera\/.* Version\/([\d.]*)/))&&m[1])o[shell]=numberify(m[1]);if((m=ua.match(/Opera Mini[^;]*/))&&m)o[MOBILE]=m[0].toLowerCase();else if((m=ua.match(/Opera Mobi[^;]*/))&&m)o[MOBILE]=m[0]}}else if((m=ua.match(/MSIE\s([^;]*)/))&&m[1]){o[core="trident"]=0.1;o[shell="ie"]=numberify(m[1]);if((m=ua.match(/Trident\/([\d.]*)/))&&
m[1])o[core]=numberify(m[1])}else if(m=ua.match(/Gecko/)){o[core="gecko"]=0.1;if((m=ua.match(/rv:([\d.]*)/))&&m[1])o[core]=numberify(m[1]);if((m=ua.match(/Firefox\/([\d.]*)/))&&m[1])o[shell="firefox"]=numberify(m[1])}o.core=core;o.shell=shell;o._numberify=numberify;return o}(),UA_EXTRA=function(UA){var ua=navigator.userAgent,m,external,shell,o={},numberify=UA._numberify;if(m=ua.match(/360SE/))o[shell="se360"]=3;else if((m=ua.match(/Maxthon/))&&(external=window.external)){shell="maxthon";try{o[shell]=
numberify(external["max_version"])}catch(ex){o[shell]=0.1}}else if(m=ua.match(/TencentTraveler\s([\d.]*)/))o[shell="tt"]=m[1]?numberify(m[1]):0.1;else if(m=ua.match(/TheWorld/))o[shell="theworld"]=3;else if(m=ua.match(/SE\s([\d.]*)/))o[shell="sougou"]=m[1]?numberify(m[1]):0.1;shell&&(o.shell=shell);return o}(UA);UA=$.extend({},UA,UA_EXTRA);browserInfo=function(){var key=UA.shell,ie,trident,ret;if("ie"===key&&(ie=UA[key])){trident=UA["trident"];switch(trident){case 4:ret="MSIE8";break;case 5:ret="MSIE9";
break;default:ret="MSIE"+ie;break}}else ret=key?capitalize(key):"Other";return ret}(),browserCoreInfo=function(){var core=UA.core,v;if("trident"===core&&(v=UA[core]))return"Trident"+v;return capitalize(core)||"Other"}(),screenInfo=function(){var screen=win.screen;return screen?screen.width+"x"+screen.height:""}();function capitalize(str){return!str?str:str.substr(0,1).toUpperCase()+str.substr(1).toLowerCase()}var Hubble=function(opt){var that=this;if(!(this instanceof arguments.callee))return new arguments.callee(opt);
this.init.apply(this,arguments)};Hubble.prototype={init:function(cfg){var self=this,config=cfg||{},apiUrl=config["apiUrl"]||"http://igw.monitor.taobao.com/monitor-gw/receive.do",pageId="appId"in config?config["appId"]:0,sampleRate="sampleRate"in config?config["sampleRate"]:1E4;if(!pageId)return;if(parseInt(Math.random()*sampleRate))return;startTime=win["g_hb_monitor_st"];if(!startTime)return;endTime=+new Date;sections=config["sections"]||[];sectionMaxImgLoadTime=endTime;if(sections.length>0)this.monitorSection(sections[0]);
$(win).bind("load",function(){self.sendData(+new Date,apiUrl,pageId)})},monitorSection:function(id){var images=$("#"+id+" img");if(!images||!images.length)return;$(images).bind("load",function(){var currTime=+new Date;if(currTime>sectionMaxImgLoadTime)sectionMaxImgLoadTime=currTime})},sendData:function(onLoadTime,apiUrl,pageId){var results=[apiUrl,"?page_id=",pageId,"&os=",OSInfo,"&bt=",browserInfo,"&bct=",browserCoreInfo,"&scr=",screenInfo,"&fl=",onLoadTime-startTime,"&dl=",endTime-startTime];if(sections.length>
0)results.push("&sl="+(sectionMaxImgLoadTime-endTime));setTimeout(function(){(new Image).src=results.join("")},1E3)}};SYS.Hubble=Hubble})(jQuery,FE.sys);
