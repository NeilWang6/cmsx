/** * @package FE.app.elf.enroll.data-sort * @author: xiaotong.huangxt * @Date: 2012-12-21 */;(function($, T) {    var readyFun = [		function() {			$("#edit-config").bind("click",function(e){				e.preventDefault();				$.use('ui-dialog', function(){					var dialog = $('.dialog-basic').dialog({						center: true,						fixed:true					});					$('.dialog-basic .btn-cancel, .dialog-basic .close').click(function(){						dialog.dialog('close');					});				});			});		},						function() {			//保存按钮事件绑定			$("#data-save").bind("click",function(e){				doSaveBlock();			});						//预览页面的事件绑定			//$("#data-preview").bind("click",function(e){			//	toShowPage();			//});						//干预数据的事件绑定			$("#data-intervene").bind("click",function(e){				toPreviewAuto();			});						//编辑推荐的保存按钮事件			$(".js-dialog-save").bind("click",function(e){				saveResult();			});						//查询按钮事件			$(".js-search").bind("click",function(e){				document.search_condition.submit();			});						//翻页按钮			$(".offer-page-num").bind("click",function(e){				pageNavigation($(this).data('page'));			});			//点页码查询时间			$('#jump-page').click(function(){                var toPage = $('input.pnum').val();                var maxPage = $('.paging-t li em').text();                if( !isNaN(toPage) && parseInt(toPage) <= maxPage && parseInt(toPage) > 0 ) {                                   	pageNavigation(toPage);                }else{                    alert('请输入1 ~ ' + maxPage);                }			})			$("input.pnum").bind('keypress', function(event) {                if(event.keyCode == '13') {                    //var page = $(this).closest('.paging');                    $('#jump-page').click();                }            });			//全选按钮			$(".js-select-all").bind("click",function(e){				if( $('#is-select-all').val() == '1' ) {					$('#is-select-all').val('0');					invertSelect();				} else {					$('#is-select-all').val('1');					selectAll();				}			});			//分页烂跟随			var fixBottom = $('.fixed-bottom');			$('body').css('position','relative');			var top = $(document).scrollTop();			fixBottom.css({'bottom': $(document).height() - top - $(window).height() + 8 });			$(document).scroll(function(){				// var documentHeight = $(document).height() - 400;				var top = $(document).scrollTop();				// if( top + 10 > documentHeight) { top = pretop };								fixBottom.css({'bottom': $(document).height() - top - $(window).height() + 8 })				pretop = top			})			//两个特殊的下拉框			jQuery(function($){				//批量归类                new FE.tools.Select('#selectblock', {                    dataText: 'text',                    css: {'top':'-120px', 'overflow-y': 'scroll', 'height': '116px'},                    selected: function(el, selectedEl){						document.saveBlock.blockId.value = selectedEl.data('val');                    }                });				//排序方式下拉框选项更改时                new FE.tools.Select('#orderParam', {					optionEl: 'dd',                    dataText: 'text',					selected: function(el, selectedEl){                        //var param=$(this).children('option:selected').val();						document.search_condition.orderByParam.value = selectedEl.data('val');						document.search_condition.submit();                    }                });            });		}	];    $(function() {        for(var i = 0, l = readyFun.length; i < l; i++) {            try {                readyFun[i]();            } catch(e) {                if($.log) {                    $.log('Error at No.' + i + '; ' + e.name + ':' + e.message);                }            } finally {                continue;            }        }    });	function toShowPage() {		window.location = $('#showPage').val();	}	function toPreviewAuto() {		var offers = '';				$('.check-offerid').each(function(index,obj){			var jobj = $(obj);			if(jobj.attr('checked') == 'checked'){				var jchk = $('#checked'+jobj.attr('id'));				if(jchk.attr('value')) {					var blockId = jchk.attr('data-value');					var offerId = jobj.attr('id');					offers = offers + blockId + ":" + offerId +";";				}				}		});		document.toPreviewWithOffers.offers.value = offers;			document.toPreviewWithOffers.submit();	}		function saveResult(){		document.batchSaveBlock.submit();	}	function saveResultAndPreview(){		document.batchSaveBlock.preview.value=true;		document.batchSaveBlock.submit();	}	function pageNavigation(page){		document.search_condition.page.value = page;		document.search_condition.orderByParam.value = $('#orderParam').children('option:selected').val();		document.search_condition.submit();		return true;	}	function selectAll(){		//$(ele).next('input:checkbox').attr('checked',false);		$('.check-offerid').each(function(index, obj){			$(obj).attr('checked','checked');		});	}		function invertSelect(){		//$(ele).prev('input:checkbox').attr('checked',false);		$('.check-offerid').each(function(index,obj){			$(obj).attr('checked',false);		});	}		function doSaveBlock() {		if( document.saveBlock.blockId.value == "0" ) {			return ;		}				var insertvalue = '';		var updateValue= '';		$('.check-offerid').each(function(index,obj){			var jobj = $(obj);			if(jobj.attr('checked') == 'checked'){				var jchk = $('#checked'+jobj.attr('id'));				if(jchk.attr('value')) {					if(updateValue == ''){						updateValue = jchk.attr('value');					}					else{						updateValue = updateValue+","+jchk.attr('value');					}				} else {					if(insertvalue == ''){						insertvalue = $(obj).attr('id');					} else {						insertvalue = insertvalue+","+$(obj).attr('id');					}				}			}		});		document.saveBlock.selectedOfferIds.value = insertvalue;			document.saveBlock.updateBlockDataIds.value = updateValue;		document.saveBlock.submit();	}	})(jQuery, FE.tools);