function Boxy(element,options){this.boxy=jQuery(Boxy.WRAPPER);jQuery.data(this.boxy[0],"boxy",this);this.visible=false;this.options=jQuery.extend({},Boxy.DEFAULTS,options||{});this.setContent(element||"<div></div>");this._setupTitleBar();this.boxy.css("display","none").appendTo(document.body);this.toTop();if(this.options.fixed)if(jQuery.browser.msie&&jQuery.browser.version<7)this.options.fixed=false;else this.boxy.addClass("fixed");if(this.options.center&&Boxy._u(this.options.x,this.options.y))this.center();
else this.moveTo(Boxy._u(this.options.x)?this.options.x:Boxy.DEFAULT_X,Boxy._u(this.options.y)?this.options.y:Boxy.DEFAULT_Y);if(this.options.show)this.show()}Boxy.EF=function(){};
jQuery.extend(Boxy,{WRAPPER:"<table cellspacing='0' cellpadding='0' border='0' class='boxy-wrapper'>"+"<tr><td class='top-left'></td><td class='top'></td><td class='top-right'></td></tr>"+"<tr><td class='left'></td><td class='boxy-inner'></td><td class='right'></td></tr>"+"<tr><td class='bottom-left'></td><td class='bottom'></td><td class='bottom-right'></td></tr>"+"</table>",DEFAULTS:{title:null,closeable:true,center:true,show:true,modal:true,fixed:false,closeText:"[\u5173\u95ed]",behaviours:Boxy.EF,
afterShow:Boxy.EF,afterHide:Boxy.EF,beforeHide:Boxy.EF},DEFAULT_X:50,DEFAULT_Y:50,zIndex:1337,get:function(ele){var p=jQuery(ele).parents(".boxy-wrapper");return p.length?jQuery.data(p[0],"boxy"):null},_u:function(){for(var i=0;i<arguments.length;i++)if(typeof arguments[i]!="undefined")return false;return true},_nextZ:function(){return Boxy.zIndex++},_viewport:function(){var d=document.documentElement,b=document.body,w=window;return jQuery.extend(jQuery.browser.msie?{left:b.scrollLeft||d.scrollLeft,
top:b.scrollTop||d.scrollTop}:{left:w.pageXOffset,top:w.pageYOffset},!Boxy._u(w.innerWidth)?{width:w.innerWidth,height:w.innerHeight}:!Boxy._u(d)&&!Boxy._u(d.clientWidth)&&d.clientWidth!=0?{width:d.clientWidth,height:d.clientHeight}:{width:b.clientWidth,height:b.clientHeight})}});
Boxy.prototype={estimateSize:function(){this.boxy.css({visibility:"hidden",display:"block"});var dims=this.getSize();this.boxy.css("display","none").css("visibility","visible");return dims},getSize:function(){return[this.boxy.width(),this.boxy.height()]},getContentSize:function(){var c=this.getContent();return[c.width(),c.height()]},getPosition:function(){var b=this.boxy[0];return[b.offsetLeft,b.offsetTop]},getCenter:function(){var p=this.getPosition();var s=this.getSize();return[Math.floor(p[0]+
s[0]/2),Math.floor(p[1]+s[1]/2)]},getInner:function(){return jQuery(".boxy-inner",this.boxy)},getContent:function(){return jQuery(".boxy-content",this.boxy)},setContent:function(newContent){newContent=jQuery(newContent).css({display:"block"}).addClass("boxy-content");this.getContent().remove();this.getInner().append(newContent);this._setupDefaultBehaviours(newContent);this.options.behaviours.call(this,newContent);return this},moveTo:function(x,y){this.moveToX(x).moveToY(y);return this},moveToX:function(x){if(typeof x==
"number")this.boxy.css({left:x});else this.centerX();return this},moveToY:function(y){if(typeof y=="number")this.boxy.css({top:y});else this.centerY();return this},centerAt:function(x,y){var s=this[this.visible?"getSize":"estimateSize"]();if(typeof x=="number")this.moveToX(x-s[0]/2);if(typeof y=="number")this.moveToY(y-s[1]/2);return this},centerAtX:function(x){return this.centerAt(x,null)},centerAtY:function(y){return this.centerAt(null,y)},center:function(axis){var v=Boxy._viewport();var o=this.options.fixed?
[0,0]:[v.left,v.top];if(!axis||axis=="x")this.centerAt(o[0]+v.width/2,null);if(!axis||axis=="y")this.centerAt(null,o[1]+v.height/2);return this},centerX:function(){return this.center("x")},centerY:function(){return this.center("y")},isVisible:function(){return this.visible},show:function(){if(this.visible)return;if(this.options.modal){var self=this;this.modalBlackout=jQuery('<div class="boxy-modal-blackout"><iframe style="position:absolute;z-index:-1;width:100%;height:100%;filter:alpha(opacity=0);-moz-opacity:0"></iframe></div>').css({zIndex:Boxy._nextZ(),
opacity:0.7}).appendTo(document.body);this.toTop();if(this.options.closeable)jQuery(document.body).bind("keypress.boxy",function(evt){var key=evt.which||evt.keyCode;if(key==27){self.hide();jQuery(document.body).unbind("keypress.boxy")}})}this.boxy.stop().css({opacity:1}).show();this.visible=true;this._fire("afterShow");return this},hide:function(after){if(this._fire2("beforeHide")===false)return;if(!this.visible)return;var self=this;if(this.options.modal){jQuery(document.body).unbind("keypress.boxy");
this.modalBlackout.remove()}this.boxy.stop().css("display","none");this.visible=false;this._fire("afterHide");if(after)after(this);return this},toggle:function(){this[this.visible?"hide":"show"]();return this},toTop:function(){this.boxy.css({zIndex:Boxy._nextZ()});return this},getTitle:function(){return jQuery("> .title-bar h2",this.getInner()).html()},setTitle:function(t){jQuery("> .title-bar h2",this.getInner()).html(t);return this},removeOtherNull:function(){jQuery(".boxy-wrapper").not(jQuery(".boxy-wrapper:has(.boxy-content)")).remove()},
_setupTitleBar:function(){if(this.options.title){var self=this;var tb=jQuery("<div class='title-bar'></div>").html("<h2>"+this.options.title+"</h2>");if(this.options.closeable)tb.append(jQuery("<a href='#' class='boxy-close'></a>").html(this.options.closeText));this.getInner().prepend(tb);this._setupDefaultBehaviours(tb)}},_setupDefaultBehaviours:function(root){var self=this;jQuery(".boxy-close",root).click(function(){self.hide();return false}).mousedown(function(evt){evt.stopPropagation()})},_fire:function(event){this.options[event].call(this)},
_fire2:function(event){return this.options[event].call(this)}};
