(function(c){c.namespace("FE.platform.widget");var b=FE.platform.widget,d={title:["--请选择--","--请选择--","--请选择--"],showTitle:true,vals:["","",""],texts:["","",""],autoComplete:true,autoPopup:true,pcaDomain:"upload.1688.com",format:false,callbackFlags:[true,true,true]};var a=b.PCA=function(e,f){if(f.store){this.init(e,f)}};a.prototype={iP:null,iC:null,ie6:c.util.ua.ie6,getPCAUrl:"http://{0}/company/getMultiCategoryInfo.htm",init:function(k,l){var f=this;l=l||{};f.defaults=c.extend({},d,l);if(f.defaults.format){f.defaults.texts=f.formatting(f.defaults.texts)}for(var h=0,g=k.length;h<g;h++){switch(h){case 0:f.elP=c(k[0]);if(f.elC||f.defaults.onPSelected){f.comboboxP=f.elP.addClass("pca-province").combobox({name:"province",multiple:false,itemNode:"dd",tpl:function(s){if(f.defaults.comboboxPtpl){return f.defaults.comboboxPtpl.call(this,f.comboboxP,s)}var n=c("<div>"),m=s[0][0],x=s[1];for(var t=0,r=m.length;t<r;t++){var u=c("<dl>"),o=c("<dt>").append(document.createTextNode(m[t])).appendTo(u);if(t===r-1){u.addClass("last-row")}for(var q=0,p=x[t][0].length;q<p;q++){var y={value:x[t][1][q],text:x[t][0][q]},v=c("<span>"),w=c("<dd>",{catid:y.value}).addClass("ui-combobox-item").bind("click.combobox",y,function(j){var i=c(this);if(i.hasClass("ui-combobox-selected")){}else{f.comboboxP.combobox("select",j.data.value);i.addClass("ui-combobox-selected")}}).data("item",y);u.append(w.append(v.append(document.createTextNode(x[t][0][q]))))}n.append(u)}return n},resultTpl:function(i){return i.text},listrender:function(){},change:function(){if(f.elC){var m=f.elA.find("input.result"),j=m.next("input[type=hidden]"),i=f.elA.find("div.list ul");c("input.result",f.elP).trigger("blur");c("input.result",f.elC).attr("disabled",false);c("a.trigger",f.elC).attr("disabled",false);f.iP=c("input[type=hidden]",f.elP).val();m.val("").attr("disabled",true);c("a.trigger",f.elA).attr("disabled",true);j.val("");i.remove();c("input.result",f.elA).trigger("blur");f.elP.css("zIndex",1);if(f.defaults.onPSelected){f.defaults.onPSelected.call(this,f.defaults.callbackFlags[0])}if(f.defaults.texts.length===2||f.defaults.vals.length===2){f.cityBind(f.defaults.vals.shift(),f.defaults.texts.shift())}else{f.cityBind.call(f)}}},data:[[""]]})}break;case 1:f.elC=c(k[1]);if(f.elA||f.defaults.onCSelected){f.comboboxC=f.elC.addClass("pca-city").combobox({name:"city",multiple:false,itemNode:"li",tpl:function(s){if(s[0]===""){return}if(f.defaults.comboboxCtpl){return f.defaults.comboboxCtpl.call(this,f.comboboxC,s)}var p=c("<ul>",{"class":"fd-clr",parentid:f.iP});for(var o=0,n=s.length;o<n;o++){var r=s[o],q=c("<span>"),m=c("<li>",{catid:r.value}).addClass("ui-combobox-item").bind("click.combobox",r,function(j){var i=c(this);if(i.hasClass("ui-combobox-selected")){}else{f.comboboxC.combobox("select",j.data.value);i.addClass("ui-combobox-selected")}}).data("item",r);p.append(m.append(q.append(document.createTextNode(r.name))))}return p},resultTpl:function(i){return i.name},listrender:function(){},change:function(){if(f.elA){c("input.result",f.elC).trigger("blur");f.iC=c("input[type=hidden]",f.elC).val();c("input.result",f.elA).attr("disabled",false);c("a.trigger",f.elA).attr("disabled",false);f.elC.css("zIndex",1);if(f.defaults.onCSelected){f.defaults.onCSelected.call(this,f.defaults.callbackFlags[1])}if(f.defaults.texts.length===1||f.defaults.vals.length===1){f.areaBind(f.defaults.vals.shift(),f.defaults.texts.shift())}else{f.areaBind.call(f)}}},data:[""]});f.elC.find("input.result").attr("disabled",true);f.elC.find("a.trigger").attr("disabled",true);f.cacheC=c("<div>",{"class":"pca-cache",css:{display:"none"}}).appendTo(f.elC)}break;case 2:f.elA=c(k[2]);f.comboboxA=f.elA.addClass("pca-area").combobox({name:"area",multiple:false,tpl:function(o){if(o[0]===""){return}if(f.defaults.comboboxAtpl){return f.defaults.comboboxAtpl.call(this,f.comboboxA,o)}var q=c("<ul>",{"class":"fd-clr",parentid:f.iC}),m=o[0],r=o[1];for(var p=0,n=o.length;p<n;p++){var u=o[p],s=c("<span>"),t=c("<li>",{catid:u.value}).addClass("ui-combobox-item").bind("click.combobox",u,function(j){var i=c(this);if(i.hasClass("ui-combobox-selected")){}else{f.comboboxA.combobox("select",j.data.value);i.addClass("ui-combobox-selected")}}).data("item",u);q.append(t.append(s.append(document.createTextNode(u.name))))}return q},resultTpl:function(i){return i.name},listrender:function(){},change:function(){c("input.result",f.elA).trigger("blur");f.elA.css("zIndex",1);if(f.defaults.onASelected){f.defaults.onASelected.call(this,f.defaults.callbackFlags[2])}},data:[""]});f.elA.find("input.result").attr("disabled",true);f.elA.find("a.trigger").attr("disabled",true);f.cacheA=c("<div>",{"class":"pca-cache",css:{display:"none"}}).appendTo(f.elA);break}}if(f.defaults.showTitle){var e=c("input.result",c(k));e.attr("placeholder","--请选择--");f.placeHolder(e)}if(f.ie6){f.elP.find("div.ui-combobox-panel").bgiframe();f.elC.find("div.ui-combobox-panel").bgiframe();f.elA.find("div.ui-combobox-panel").bgiframe()}f.zindexHandle(c("input.result",f.elP),f.elP);f.zindexHandle(c("input.result",f.elC),f.elC);f.zindexHandle(c("input.result",f.elA),f.elA);f.provinceBind(f.defaults.vals.shift(),f.defaults.texts.shift())},provinceBind:function(n,m){var f=this,e=f.defaults.store[1][0][1]?1:0,l=f.defaults.store;if(m&&!n){for(var k=0,h=f.defaults.store[1].length;k<h;k++){var g=f.defaults.store[1][k][0].indexOf(m);if(g>-1){n=f.defaults.store[1][k][e][g];break}}}if(!m&&n){for(var k=0,h=f.defaults.store[1].length;k<h;k++){var g=f.defaults.store[1][k][e].indexOf(n);if(g>-1){m=f.defaults.store[1][k][0][g];break}}}f.iP=n?n:null;f.comboboxP.combobox("reset",l);if(n){c(".ui-combobox-item",f.elP).filter("[catid="+n+"]").trigger("click.combobox");return}else{c("input.result",f.elP).trigger("blur")}},cityBind:function(i,h){var f=this;if(f.iP!==null){var e=c("ul[parentid="+f.iP+"]",f.cacheC);if(e.length>0){c("input.result",f.elC).val("");c("input[type=hidden]",f.elC).val("");e.clone(true,true).replaceAll(c("div.ui-combobox-panel ul",f.elC));if(e.find("li").length===1&&f.defaults.autoComplete){i=c("div.ui-combobox-panel li",f.elC).attr("catid");f.iC=i?i:null;if(f.iC!==null){c("div.ui-combobox-panel li.ui-combobox-item",f.elC).filter("[catid="+i+"]").trigger("click.combobox")}else{c("input.result",f.elC).trigger("blur")}return}if(f.defaults.autoPopup){c("input.result",f.elC).trigger("click")}if(h&&!i){i=c(".ui-combobox-item:contains("+h+")",f.elC).attr("catid")}f.iC=i?i:null;if(f.iC!==null){c("div.ui-combobox-panel li.ui-combobox-item",f.elC).filter("[catid="+i+"]").trigger("click.combobox")}else{c("input.result",f.elC).trigger("blur")}}else{var g={type:"Area",id:f.iP};c.ajax(c.util.substitute(f.getPCAUrl,[f.defaults.pcaDomain]),{dataType:"jsonp",data:g,success:function(k){if(k.success){var j=k.data.result;f.comboboxC.combobox("reset",j);c("div.ui-combobox-panel ul",f.elC).clone(true,true).appendTo(f.cacheC);if(j.length===1&&f.defaults.autoComplete){i=c("div.ui-combobox-panel li",f.elC).attr("catid")}if(f.defaults.autoPopup){c("input.result",f.elC).trigger("click")}if(h&&!i){i=c(".ui-combobox-item:contains("+h+")",f.elC).attr("catid")}f.iC=i?i:null;if(f.iC!==null){c("div.ui-combobox-panel li.ui-combobox-item",f.elC).filter("[catid="+i+"]").trigger("click.combobox")}else{c("input.result",f.elC).trigger("blur")}}},error:function(){f.flagC=false}})}}},areaBind:function(m,l){var f=this;if(f.iP!==null&&f.iC!=null){var e=c("ul[parentid="+f.iC+"]",f.cacheA);if(e.length>0){var j=c("div.list",f.elA);j.find("ul").remove();c("input.result",f.elA).val("");c("input[type=hidden]",f.elA).val("");e.clone(true,true).appendTo(j);if(e.find("li").length===1&&f.defaults.autoComplete){m=c("div.ui-combobox-panel li",f.elA).attr("catid");f.iA=m?m:null;if(f.iA!==null){c("div.ui-combobox-panel li.ui-combobox-item",f.elA).filter("[catid="+m+"]").trigger("click.combobox")}else{c("input.result",f.elA).trigger("blur")}return}if(f.defaults.autoPopup){c("input.result",f.elA).trigger("click")}if(l&&!m){var g=c(".ui-combobox-item:contains("+l+")",f.elA);for(var h=0;h<g.length;h++){if(c(g[h]).text()===l){m=c(g[h]).attr("catid");break}}}f.iA=m?m:null;if(f.iA!==null){c("div.ui-combobox-panel li.ui-combobox-item",f.elA).filter("[catid="+m+"]").trigger("click.combobox")}else{c("input.result",f.elA).trigger("blur")}f.defaults.callbackFlags=[true,true,true]}else{var k={type:"Area",id:f.iC};c.ajax(c.util.substitute(f.getPCAUrl,[f.defaults.pcaDomain]),{dataType:"jsonp",data:k,success:function(r){if(r.success){var p=r.data.result;f.comboboxA.combobox("reset",p);c("div.ui-combobox-panel ul",f.elA).clone(true,true).appendTo(f.cacheA);if(f.defaults.autoPopup){c("input.result",f.elA).trigger("click")}if(p.length===1&&f.defaults.autoComplete){m=c("div.ui-combobox-panel li",f.elA).attr("catid")}if(l&&!m){var n=c(".ui-combobox-item:contains("+l+")",f.elA);for(var q=0;q<n.length;q++){if(c(n[q]).text()===l){m=c(n[q]).attr("catid");break}}}f.iA=m?m:null;if(f.iA!==null){c("div.ui-combobox-panel li.ui-combobox-item",f.elA).filter("[catid="+m+"]").trigger("click.combobox")}else{c("input.result",f.elA).trigger("blur")}f.defaults.callbackFlags=[true,true,true]}},error:function(){}})}}},setValue:function(g,f){var e=this;if(g.length>0){e.defaults.texts=e.formatting(g)}e.defaults.vals=f;e.defaults.callbackFlags=[false,false,false];e.provinceBind(e.defaults.vals.shift(),e.defaults.texts.shift())},zindexHandle:function(g,f){var h=this,e;g.bind("click",function(){f.css("zIndex",2000);e=c("div.combobox");e.not(f).css("zIndex",1)});c(document).bind("mousedown.combobox",{com:f[0]},function(i){if(c(i.target).closest(".ui-combobox")[0]!==i.data.com){if(f.css("zIndex")!="1"){f.css("zIndex",1)}}else{if(f.css("zIndex")!="2000"){f.css("zIndex",2000);e=c("div.combobox");e.not(f).css("zIndex",1)}}})},placeHolder:function(e){var f=this;if(!("placeholder" in document.createElement("input"))){e.each(function(h,g){var p=c(g),m=p.attr("placeholder"),o=p.closest("div"),n=c("<label>"),l,k,j=g.id;if(!j){j="ph"+c.guid++;p.attr("id",j)}l=p.position();k={left:l.left+3,top:l.top+3};p.after(n);n.html(m).attr("for",j).css({position:"absolute",left:k.left+"px",top:k.top+"px",color:"#CCC",cursor:"text"});p.val()&&n.hide();p.bind({focus:function(){n.hide()},blur:function(){if(this.value){n.hide()}else{n.show()}}}).triggerHandler("blur")})}},formatting:function(f){var e=this;if(f[0]!==""){if(f.length<3){if(f.length===1){var g=f[0].slice(0,3);if(g==="上海市"||g==="北京市"||g==="天津市"||g==="重庆市"){g=g.slice(0,2);f.unshift(g);f.unshift(g)}else{f.push("");f.push("")}}else{f.push("")}}}if(f[0]!==""){if(f[0]==="上海市"||f[0]==="北京市"||f[0]==="天津市"||f[0]==="重庆市"){f[0]=f[0].slice(0,2);f[1]=f[0];if(f[2].lastIndexOf("区")>-1){f[2]=f[0]+"市"+f[2]}}else{if(f[0].lastIndexOf("省")>-1){f[0]=f[0].slice(0,f[0].length-1)}else{if(f[0].lastIndexOf("自治区")>-1||f[0].lastIndexOf("特别行政区")>-1){if(f[0].lastIndexOf("内蒙古")>-1){f[0]="内蒙古"}else{f[0]=f[0].slice(0,2)}}}if((f[2].lastIndexOf("区")>-1)&&!(f[2].indexOf("市")>-1)){switch(f[2]){default:f[2]=f[1]+f[2];break;case"苏州工业园区":break;case"神农架林区":break;case"六枝特区":break;case"铜仁地区万山特区":break;case"万山特区":break;case"大兴安岭地区加格达奇区":break;case"大兴安岭地区呼中区":break;case"大兴安岭地区松岭区":break;case"大兴安岭地区新林区":break;case"益阳高新区":break;case"高新开发区":break;case"鱼梁洲开发区":break;case"隆中风景区":break}}else{if(f[2]==="市区"){f[2]=f[1]}else{if((f[2].lastIndexOf("区")>-1)&&(f[2].indexOf("市")>-1)){switch(f[2]){case"市中区":f[2]=f[1]+f[2];break;case"市南区":f[2]=f[1]+f[2];break;case"市北区":f[2]=f[1]+f[2];break;default:break}}}}if(f[1].lastIndexOf("市")>-1){f[1]=f[1].slice(0,f[1].length-1)}else{if((f[0].indexOf("西藏")>-1)&&(f[1].indexOf("地区")>-1)){f[1]=f[1].slice(0,f[1].length-2)}else{if(f[1].indexOf("地区")>-1){switch(f[1]){default:break;case"铜仁地区":f[1]="铜仁";break;case"大兴安岭地区":f[1]="大兴安岭";break}}}}}}return f}}})(jQuery);