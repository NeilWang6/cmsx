/*!!cmd:compress=true*/
/*!!cmd:jsCompressOpt=["--disable-optimizations"]*/
("alitalk" in FE.util)||(function($,Util){jQuery.add("webww-package",{js:["http://style.c.aliimg.com/sys/js/webww/package.js"],ver:"1.0"});var ie=$.util.ua.ie,$extendIf=$.extendIf,isMac=function(){return(navigator.platform.indexOf("Mac")>-1)},defaults={cls:{base:"alitalk",on:"alitalk-on",off:"alitalk-off",mb:"alitalk-mb"},attr:"alitalk",siteID:"cnalichn",remote:true,plugin:false,prop:function(){var data=$(this).data("alitalk");if(typeof(data)=="undefined"||typeof(data.offerid)=="undefined"){return""}return"&gid="+data.offerid},fenliu:1,getAlitalk:function(id,options){var lazyLoad=options.lazyLoad;var data=$(this).data("alitalk");var offerid="";if(typeof(data)=="undefined"){offerid="undefined"}else{offerid=data.offerid}if(lazyLoad){jQuery.use("webww-package",function(){if(!(FE.sys&&FE.sys.webww&&FE.sys.webww.main&&FE.sys.webww.main.chatTo(id))){$(document).bind("webww_load_complete",function(){FE.sys.webww.main.chatTo(id,true,offerid)})}else{FE.sys.webww.main.chatTo(id,true,offerid)}})}else{if(!(FE.sys&&FE.sys.webww&&FE.sys.webww.main&&FE.sys.webww.main.chatTo(id))){window.open("http://webww.1688.com/message/my_chat.htm?towimmid="+id+"&offerid="+offerid,"_blank")}}},onRemote:function(data){var element=$(this);switch(data.online){case 0:case 2:case 6:default:element.html("\u7ed9\u6211\u7559\u8a00").attr("title","\u6211\u4e0d\u5728\u7f51\u4e0a\uff0c\u7ed9\u6211\u7559\u4e2a\u6d88\u606f\u5427");break;case 1:element.html("\u548c\u6211\u8054\u7cfb").attr("title","\u6211\u6b63\u5728\u7f51\u4e0a\uff0c\u9a6c\u4e0a\u548c\u6211\u6d3d\u8c08");break;case 4:case 5:element.html("\u7ed9\u6211\u77ed\u4fe1").attr("title","\u6211\u624b\u673a\u5728\u7ebf\uff0c\u9a6c\u4e0a\u548c\u6211\u6d3d\u8c08");break}}},version=0,isInstalled=(function(){if(ie){var vers={"aliimx.wangwangx":6,"Ali_Check.InfoCheck":5};for(var p in vers){try{new ActiveXObject(p);version=vers[p];return true}catch(e){}}}if(isMac()||$.browser.mozilla||$.browser.safari){var res=false;var self=this;$(function(){if(navigator.mimeTypes["application/ww-plugin"]){var plugin=$("<embed>",{type:"application/ww-plugin",css:{visibility:"hidden",overflow:"hidden",display:"block",position:"absolute",top:0,left:0,width:1,height:1}});plugin.appendTo(document.body);if(isMac()||(plugin[0].NPWWVersion&&numberify(plugin[0].NPWWVersion())>=1.003)||(plugin[0].isInstalled&&plugin[0].isInstalled(1))){version=6;res=true;if(Util.alitalk){Util.alitalk.isInstalled=true}}self.plugin=plugin}});return res}return false})();function success(obj,elements,options){if(obj.success){var arr=obj.data;elements.each(function(i){var element=$(this),data=element.data("alitalk");if(data){data.online=arr[i];element.addClass(data.cls.base);switch(data.online){case 0:case 2:case 6:default:element.addClass(data.cls.off);break;case 1:element.addClass(data.cls.on);break;case 4:case 5:element.addClass(data.cls.mb);break}if(data.onRemote){data.onRemote.call(element[0],data)}}})}if(options.onSuccess){options.onSuccess()}}function invokeWW(cmd){var flag=1;if(ie){try{(new ActiveXObject("aliimx.wangwangx")).ExecCmd(cmd);flag=0}catch(e){}}else{try{var mimetype=navigator.mimeTypes["application/ww-plugin"];if(mimetype){var plugin=this.plugin;plugin.appendTo(document.body);plugin[0].SendCommand(cmd,1);flag=0}}catch(e){}}if(flag==1){var ifr=$("<iframe>").css("display","none").attr("src",cmd).appendTo("body");setTimeout(function(){ifr.remove()},200)}}function onClickHandler(event){var element=$(this),data,feedback,prop,info_id;if(event){event.preventDefault();data=element.data("alitalk")}else{data=this}if(!data.remote){data.online=1}if(data.online===null){return}prop=data.prop;if(typeof prop==="function"){prop=prop.call(this);var match=prop.match(/info_id=([^#]+)/);if(match&&match.length===2){info_id=match[1]}}if(isMac()){feedback=""}else{feedback="&url2=http://dmtracking.1688.com/others/feedbackfromalitalk.html?online="+data.online+"#info_id="+(data.info_id||info_id||"")+"#type="+(data.type||"")+"#module_ver=3#refer="+encodeURI(document.URL).replace(/&/g,"$")}var loginid=encodeURIComponent(data.id);switch(version){case 0:default:data.getAlitalk.call(this,data.id,data);break;case 5:invokeWW("Alitalk:Send"+(data.online===4?"Sms":"IM")+"?"+data.id+"&siteid="+data.siteID+"&status="+data.online+feedback+prop);break;case 6:if(data.online===4){invokeWW("aliim:smssendmsg?touid="+data.siteID+loginid+feedback+prop)}else{invokeWW("aliim:sendmsg?touid="+data.siteID+loginid+"&siteid="+data.siteID+"&fenliu="+data.fenliu+"&status="+data.online+feedback+prop)}break}if(data.onClickEnd){data.onClickEnd.call(this,event)}}function login(id){var src;var loginid=encodeURIComponent(id);if(version===5){src="alitalk:"}else{src="aliim:login?uid="+(loginid||"")}invokeWW(src)}function numberify(s){var c=0;return parseFloat(s.replace(/\./g,function(){return(c++===0)?".":""}))}function alitalk(elements,options){if($.isPlainObject(elements)){options=elements;options.online=options.online||1;$extendIf(options,defaults);onClickHandler.call(options)}else{options=options||{};$extendIf(options,defaults);elements=$(elements).filter(function(){return !$.data(this,options.attr)});if(elements.length){var ids=[];elements.each(function(i,elem){elem=$(elem);var data=$extendIf(eval("("+(elem.attr(options.attr)||elem.attr("data-"+options.attr)||"{}")+")"),options);elem.data("alitalk",data);ids.push(data.siteID+data.id)}).bind("click",onClickHandler);if(ids.length&&options.remote){$.ajax("http://amos.im.alisoft.com/mullidstatus.aw",{dataType:"jsonp",data:"uids="+ids.join(";"),success:function(o){success(o,elements,options)}})}}}}function tribeChat(elements){if(elements.length){elements.bind("click",onTribeChatClickHandler)}}function onTribeChatClickHandler(event){var element=$(this),data;if(event){event.preventDefault();data=element.data("alitalk");data=eval("("+data+")")}else{data=this}var uid="";if(data.uid){uid=encodeURIComponent(data.uid)}if(uid!=""&&uid.indexOf("cnalichn")<0&&uid.indexOf("cntaobao")<0&&uid.indexOf("enaliint")<0){uid="cnalichn"+uid}switch(version){case 0:default:alert("\u5c0a\u656c\u7684\u7528\u6237\uff0c\u60a8\u9700\u8981\u5b89\u88c5\u963f\u91cc\u65fa\u65fa\u540e\u624d\u80fd\u53c2\u4e0e\u7fa4\u804a\u5929\uff0c\u70b9\u51fb\u786e\u8ba4\u540e\u5c06\u8fdb\u5165\u963f\u91cc\u65fa\u65fa\u4e0b\u8f7d\u9875\u9762\u3002");window.location.href="http://wangwang.1688.com";break;case 5:case 6:invokeWW("aliim:tribejoin?tribeid="+(data.tribeid||"")+"&uid="+uid);break}if(data.onClickEnd){data.onClickEnd.call(this,event)}}Util.alitalk=alitalk;Util.alitalk.version=version;Util.alitalk.isInstalled=isInstalled;Util.alitalk.login=login;Util.alitalk.tribeChat=tribeChat;$.add("web-alitalk")})(jQuery,FE.util);
