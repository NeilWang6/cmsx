FD.widget.Marquee=function(A,B){this._init(A,B)};FD.widget.Marquee.defConfig={isAutoPlay:true,timeDelay:3,speed:0.5,liLength:null,direction:"left",preItem:1,loopType:"loop",easing:"easeInStrong",scrollOffset:0,onNextEnd:function(){},onPreEnd:function(){},onNextRs:function(){},onPreRs:function(){}};FD.widget.Marquee.prototype={_init:function(B,E){this.container=$(B);this.config=FD.common.applyIf(E||{},FD.widget.Marquee.defConfig);this.isH=(this.config.direction=="up"||this.config.direction=="down")?false:true;var G=$D.getFirstChild(this.container);if(G.tagName.toLowerCase()!="ul"){return}var D=FYD.getChildren(G),A=D.length;var F=this.config.liLength||(this.isH?D[0].offsetWidth:D[0].offsetHeight);this.preDistance=F*(this.config.preItem>A?this.config.preItem%A:this.config.preItem);this.ulLength=F*A;if(["easeInStrong","easeNone","easeOutStrong"].contains(this.config.easing)){var H=this.config.easing;this.easing=$Y.Easing.oe}else{this.easing=$Y.Easing.easeInStrong}this.isScrolling=false;this.nextButtonAble=true;if(this.config.loopType=="loop"){this.preButtonAble=true;G.innerHTML+=G.innerHTML;$D.setStyle(G,this.isH?"width":"height",this.ulLength*2+"px")}else{this.preButtonAble=false;var C=Math.round(this.container[this.isH?"offsetWidth":"offsetHeight"]/F);if(A%C){this.scrollAbleLen=this.ulLength+(C-A%C)*F}else{this.scrollAbleLen=(A-(A%C))*F}$D.setStyle(G,this.isH?"width":"height",this.ulLength+(C-A%C)*F+"px")}this.container[this.isH?"scrollLeft":"scrollTop"]=this.config.scrollOffset;if(this.config.isAutoPlay){this.autoDirection=(this.config.direction=="left"||this.config.direction=="up")?"next":"pre";this._autoPlay();this._addMouseover()}},_autoPlay:function(){var A=this;this.autoTimeId=setTimeout(function(){A._getItem(A.autoDirection)},this.config.timeDelay*1000)},_addMouseover:function(){$E.on(this.container,"mouseenter",function(){clearTimeout(this.autoTimeId)},this,true);$E.on(this.container,"mouseleave",function(){this._autoPlay()},this,true)},_getItem:function(E){if(this.isScrolling){return}this.isScrolling=true;clearTimeout(this.autoTimeId);var B=E=="next"?this.preDistance:-this.preDistance;var A=this;if(A.isH){var D={scroll:{by:[B,0]}}}else{var D={scroll:{by:[0,B]}}}var C=new $Y.Scroll(this.container,D,this.config.speed,this.easing);if(this.config.loopType=="loop"){C.onStart.subscribe(function(){if(E=="pre"&&A.container[A.isH?"scrollLeft":"scrollTop"]<=A.preDistance){A.container[A.isH?"scrollLeft":"scrollTop"]+=A.ulLength}});C.onComplete.subscribe(function(){A.isScrolling=false;if(E=="next"&&A.container[A.isH?"scrollLeft":"scrollTop"]>=A.ulLength){A.container[A.isH?"scrollLeft":"scrollTop"]-=A.ulLength}if(A.config.isAutoPlay){A._autoPlay()}})}else{C.onComplete.subscribe(function(){A.isScrolling=false;var F=A.container[A.isH?"scrollLeft":"scrollTop"];if(E=="next"){if(!A.preButtonAble){A.config.onPreRs.call(A);A.preButtonAble=true}if((F+B)>=A.scrollAbleLen){A.config.onNextEnd.call(A);A.nextButtonAble=false}}else{if(!A.nextButtonAble){A.config.onNextRs.call(A);A.nextButtonAble=true}if(F<=0){A.config.onPreEnd.call(A);A.preButtonAble=false}}})}C.animate()},getPre:function(){if(this.preButtonAble){this._getItem("pre")}},getNext:function(){if(this.nextButtonAble){this._getItem("next")}},pause:function(){clearTimeout(this.autoTimeId)},start:function(){if(!this.config.isAutoPlay){this.config.isAutoPlay=true;this._addMouseover();if(!this.autoDirection){this.autoDirection=(this.config.direction=="left"||this.config.direction=="up")?"next":"pre"}}this._getItem(this.autoDirection)},setAutoDirection:function(A){if(A=="pre"||A=="next"){this.autoDirection=A}}};
