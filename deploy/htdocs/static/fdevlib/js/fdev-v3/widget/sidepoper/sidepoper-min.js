FD.widget.SidePop=function(C,A,B){this.init(C,A,B)};FD.widget.SidePop.defConfig={position:null,originWidth:null,originHeight:null,initWidth:null,initHeight:null,remainArea:32,initTop:null,btnset:3,scroll:1,hideTime:0.2,initExe:0,exeDelay:0,doAfterClose:null,dockSide:1,departure:0,baseline:0,popregion:300,isFixed:0,bias:0,expandDir:0,expandSpeed:0.1,floatSpeed:0.2,defaultShell:0,shellBlank:8,zIndex:1000};FD.widget.SidePop.purge=function(C){var B=new FD.widget.SidePop("sidePop-purge","",{});var A=B.registry.length;while(A-->0){if(C&&B.registry[A].obj.id==C){B.registry[A].close();B.close();B.registry.pop();B.registry[A]=B.registry[B.registry.length-1];B.registry.pop();return}else{if(!C){B.registry[A].close()}}}B.close();if(C&&A==0){B.registry.pop()}else{B.registry=[]}};FD.widget.SidePop.prototype={registry:[],init:function(L,A,C){this.config=FD.common.applyIf(C||{},FD.widget.SidePop.defConfig);var Q=this,S=Q.config;var O=["none","none","none"];if(S.btnset==1){O[2]=""}else{if(S.btnset==2){O[0]=""}else{if(S.btnset>2){O[2]="";O[0]=""}}}var P=['<div id="',L,'-bar" class="f-sidebar"><a id="',L,'-min" class="f-sidemin" style="display:',O[0],'" href="javascript:void(0)" target="_self"></a><a id="',L,'-res" class="f-sideres" style="display:',O[1],'" href="javascript:void(0)" target="_self"></a><a id="',L,'-close" class="f-sideclose" style="display:',O[2],'" href="javascript:void(0)" target="_self"></a></div>'].join("");if(!(Q.obj=FYG(L))){S.initWidth=S.initWidth||0;S.initHeight=S.initHeight||0;S.originWidth=S.originWidth||S.initWidth;S.originHeight=S.originHeight||S.initHeight;Q.obj=document.createElement("div");Q.obj.id=L;var N=FYG(S.position)||document.body;if(!N){return}N.insertBefore(Q.obj,FYD.getFirstChild(N));var R=S.defaultShell;var J=R?'<div class="f-sidepop"><div class="tt f-sidepop-tt"><div class="ttl"></div><div class="ttr"></div><div class="ttc">'+R+'<p></p></div><div class="ttr"></div></div><div class="f-sidepop-cont"><div class="f-sidepop-contin">':"";var H=R?"":"</div></div></div>";var K=R?S.expandDir==0?[S.shellBlank,S.remainArea]:[S.remainArea,S.shellBlank]:[0,0];var B=[];B[0]=S.expandDir==1&&R?S.initWidth:S.originWidth;B[1]=S.expandDir==0&&R?S.initHeight:S.originHeight;var I=A.match(/^http:\/\//g)?['<iframe id="',L,'-cont" src="',A,'" allowTransparency="true" frameborder="0" scrolling="no" width="',B[0]-K[0],'" height="',B[1]-K[1],'" ></iframe>'].join(""):['<div id="',L,'-cont" style="width:',B[0]-K[0],"px;height:",B[1]-K[1],'px;">',A,"</div>"].join("");Q.obj.innerHTML=[J,I,H,P].join("")}else{if(YAHOO.lang.isString(A)&&A&&FYG(L+"-cont")){if(A.match(/^http:\/\//g)){FYG(L+"-cont").src=A}else{FYG(L+"-cont").innerHTML=A}}Q.obj.style.display="block";var G=parseInt(0+FYD.getStyle(Q.obj,"borderLeftWidth"))+parseInt(0+FYD.getStyle(Q.obj,"borderRightWidth"));S.initWidth=S.initWidth||Q.obj.offsetWidth-G;S.initHeight=S.initHeight||Q.obj.offsetHeight-G;S.originWidth=S.originWidth||S.initWidth;S.originHeight=S.originHeight||S.initHeight;var D=document.createElement("span");D.innerHTML=P;Q.obj.appendChild(D)}Q.expandObj=R?FYG(L+"-cont"):Q.obj;var M=Q.obj,F=M.style;F.position="absolute";F.overflow="hidden";F.zIndex=S.zIndex;F.width=S.initWidth+"px";F.height=S.initHeight+"px";S.departure=S.departure=="center"?(FYD.getViewportWidth()-M.offsetWidth)/2:S.departure;S.bias=S.bias=="middle"?(FYD.getViewportHeight()-M.offsetHeight)/2:S.bias;S.obias=S.bias;if(YAHOO.env.ua.ie==6&&S.baseline==0||YAHOO.env.ua.ie==7&&S.baseline==1||YAHOO.env.ua.opera&&S.baseline==0){S.bias+=2}else{if(YAHOO.env.ua.ie==6&&S.baseline==1||YAHOO.env.ua.opera&&S.baseline==1){S.bias-=2}}F.left=S.dockSide?"auto":S.departure+"px";F.right=S.dockSide?S.departure+"px":"auto";FYE.on(M.id+"-close","click",function(){Q.close();Q.doAfterClose();return false});FYE.on(M.id+"-min","click",function(){Q.minIt();return false});FYE.on(M.id+"-res","click",function(){Q.maxIt();return false});FYD.setStyle(M,"top",(S.initTop==null?S.baseline==0?0:FYD.getViewportHeight()+FYD.getDocumentScrollTop():S.initTop)+"px");Q.firstScroll=Q.lastScroll=-S.bias;if(S.baseline>=2){FYD.setStyle(M,"top",0);FYD.setStyle(M,"position","relative");if(YAHOO.env.ua.ie!=6&&S.isFixed==1){Q.firstLeftX=FYD.getX(M);var E=document.createElement("div");M.parentNode.insertBefore(E,M);E.appendChild(M);FYD.setStyle(E,"height",M.offsetHeight+"px")}}else{if(S.baseline==1){Q.lastScroll=M.offsetHeight-FYD.getViewportHeight()-FYD.getDocumentScrollTop();Q.firstScroll=Q.lastScroll-S.bias;if(YAHOO.env.ua.ie!=6&&S.isFixed==1){FYD.setStyle(M,"position","fixed");FYD.setStyle(M,"top","auto");FYD.setStyle(M,"bottom",S.bias+"px")}}else{if(S.baseline==0){if(YAHOO.env.ua.ie!=6&&S.isFixed==1){FYD.setStyle(M,"position","fixed");FYD.setStyle(M,"top",S.bias+"px");FYD.setStyle(M,"bottom","auto")}}}}Q.aTop=FYD.getY(M);Q.abTop=Q.aTop;Q.expandTimer=null;Q.scrollTimer=null;if(S.expandDir==0){Q.size=R?S.initHeight-S.remainArea:S.initHeight}else{if(S.expandDir==1){Q.size=R?S.initWidth-S.remainArea:S.initWidth}}if(S.initExe==1){setTimeout(function(){Q.maxIt()},S.exeDelay)}else{if(S.initExe==2){setTimeout(function(){Q.minIt()},S.exeDelay)}else{if(S.initExe==3){setTimeout(function(){if(FYD.getStyle(M,"display")=="none"){return}Q.close();Q.doAfterClose()},S.exeDelay)}}}if(S.scroll){Q.scrollWith()}Q.registry.push(Q)},getFinalTop:function(){var D=this,G=D.config,E=D.obj;var B=G.baseline;var A=FYD.getDocumentScrollTop();var C=E.offsetHeight-FYD.getViewportHeight();C=C<0?0:C;if(B==0){return A+G.obias-C}else{if(B==1){return A+FYD.getViewportHeight()-E.offsetHeight-G.obias}else{if(B==2){var F=A-D.aTop+G.obias-C;return F>0?F:0}else{if(B==3){var F=A-D.aTop+G.obias-C;return F<0?F:0}else{if(B==4){var F=A-D.aTop+G.obias-C;if(popregion>0){return F>0?F<popregion?F:popregion:0}else{return F<0?F>popregion?F:popregion:0}}}}}}},close:function(){var B=this,C=B.obj;clearTimeout(B.expandTimer);clearInterval(B.scrollTimer);FYE.purgeElement(C.id+"-res");FYE.purgeElement(C.id+"-min");FYE.purgeElement(C.id+"-close");FYD.setStyle(C,"display","none");var A;if(A=FYG(C.id+"-bar")){FYG(C.id+"-bar").parentNode.removeChild(A)}},doAfterClose:function(){var A=this,B=A.config;if(YAHOO.lang.isFunction(B.doAfterClose)){B.doAfterClose()}},minIt:function(){var B=this,D=B.config,C=B.obj;(function A(){var G=D.defaultShell?0:D.remainArea;var F=[B.size<=G];if(F[0]){window.clearTimeout(B.expandTimer);FYD.setStyle(C.id+"-min","display","none");FYD.setStyle(C.id+"-res","display","block");return}var E=D.expandSpeed*B.size;E=E<1?1:E;B.size=B.size-E<=G?G:B.size-E;if(D.expandDir){B.expandObj.style.width=B.size+"px";if(D.defaultShell){C.style.width=B.size+D.remainArea+"px"}}else{B.expandObj.style.height=B.size+"px";if(D.defaultShell){C.style.height=B.size+D.remainArea+"px"}}B.expandTimer=window.setTimeout(A,10)})()},maxIt:function(){var B=this,D=B.config,C=B.obj;(function A(){var F=D.expandDir?D.originWidth:D.originHeight;F-=D.defaultShell?D.remainArea:0;var G=[B.size>=F];if(G[0]){window.clearTimeout(B.expandTimer);FYD.setStyle(C.id+"-min","display","block");FYD.setStyle(C.id+"-res","display","none");return}var E=D.expandSpeed*F;E=E<1?1:E;B.size=B.size+E>=F?F:B.size+E;if(D.expandDir){B.expandObj.style.width=B.size+"px";if(D.defaultShell){C.style.width=B.size+D.remainArea+"px"}}else{B.expandObj.style.height=B.size+"px";if(D.defaultShell){C.style.height=B.size+D.remainArea+"px"}}B.expandTimer=window.setTimeout(A,10)})()},scrollWith:function(){var A=this,C=A.config,B=A.obj;if(YAHOO.env.ua.ie!=6&&C.baseline<2&&C.isFixed==1){FYD.setStyle(B,"position","fixed");return}if(C.scroll==1){A.scrollTimer=window.setInterval(function(){var I=FYD.getDocumentScrollTop();var F=FYD.getDocumentScrollLeft();var H=C.baseline;var E,K;var G=0;var D=B.offsetHeight-FYD.getViewportHeight();D=D<0?0:D;if(C.dockSide==1){K=FYD.getViewportWidth()-B.offsetWidth+F-C.departure;FYD.setStyle(B,"left",K+"px")}else{if(C.dockSide==0){K=F+C.departure;FYD.setStyle(B,"left",K+"px")}}if(H==0){E=C.floatSpeed*(I-A.lastScroll-A.aTop-D)}else{if(H==1){E=C.floatSpeed*(-A.lastScroll+A.firstScroll+FYD.getViewportHeight()+I-B.offsetHeight-A.aTop)}else{if(H==2||H==3){var L=C.floatSpeed*(I-A.aTop-A.lastScroll-D);var J;if(H==2){J=I-A.aTop>0||(FYD.getY(B))>A.aTop}else{if(H==3){J=I-A.aTop<0||(FYD.getY(B))<A.aTop}}if(J){if(YAHOO.env.ua.ie!=6&&C.isFixed==1){E=0;FYD.setStyle(B,"position","fixed");FYD.setStyle(B,"left",A.firstLeftX+"px")}else{E=L}}else{if(YAHOO.env.ua.ie!=6&&C.isFixed==1){E=0;FYD.setStyle(B,"position","relative");FYD.setStyle(B,"left",0)}else{E=0}}}else{if(H==4){var L=C.floatSpeed*(I-A.abTop-A.lastScroll-D);if(YAHOO.env.ua.ie!=6&&C.isFixed==1){E=0;FYD.setStyle(B,"position","fixed");FYD.setStyle(B,"left",A.firstLeftX+"px")}else{E=L}}}}}if(E>-0.2&&E<0.2){return}else{E=E>0?Math.ceil(E):E=Math.floor(E)}B.style.top=parseInt(B.style.top)+E+"px";if(H==2&&parseInt(B.style.top)<=0||H==3&&parseInt(B.style.top)>=0){B.style.top=0;A.lastScroll=A.firstScroll}else{if(H==4){if(C.popregion>0&&parseInt(B.style.top)<=0){B.style.top=0;A.abTop=A.aTop;A.lastScroll=A.firstScroll}else{if(C.popregion>0&&parseInt(B.style.top)>=C.popregion){B.style.top=C.popregion+"px";A.abTop=A.aTop+C.popregion;A.lastScroll=A.firstScroll}else{if(C.popregion<0&&parseInt(B.style.top)>=0){B.style.top=0;A.abTop=A.aTop;A.lastScroll=A.firstScroll}else{if(C.popregion<0&&parseInt(B.style.top)<=C.popregion){B.style.top=C.popregion+"px";A.abTop=A.aTop+C.popregion;A.lastScroll=A.firstScroll}else{A.lastScroll+=E}}}}}else{A.lastScroll+=E}}},10)}else{if(C.scroll==2){FYE.addListener(window,"scroll",A.scrollHandler,[FYD.getStyle(B,"visibility")],A);B.style.top=A.getFinalTop()+"px"}}},scrollHide:function(D){var C=this,F=C.config,E=C.obj,D=D?1:0,A=D?0:1;if(C.ishiding){return}if(FYU.Anim){if(D){FYD.setStyle(E,"visibility","visible")}C.ishiding=1;var B=new FYU.Anim(E,{opacity:{to:D}},F.hideTime,YAHOO.util.Easing.easeIn);B.animate();B.onComplete.subscribe(function(){C.ishiding=0})}else{FYD.setStyle(E,"visibility",D?"visible":"hidden")}},scrollHandler:function(D,C){var I=this,F=I.config,A=I.obj;var G=F.baseline;var H=FYD.getDocumentScrollTop();var B=A.offsetHeight-FYD.getViewportHeight();B=B<0?0:B;var E=H-I.aTop+F.obias-B<0;window.clearTimeout(I.scrollTimer);if(G==2&&E||G==3&&!E){FYD.setStyle(A,"visibility",C);return}I.scrollHide();I.scrollTimer=window.setTimeout(function(){A.style.top=I.getFinalTop()+"px";I.scrollHide(1)},500)}};FD.widget.SidePoper=new function(){this.init=function(C,A,B){return new FD.widget.SidePop(C,A,B)}};
