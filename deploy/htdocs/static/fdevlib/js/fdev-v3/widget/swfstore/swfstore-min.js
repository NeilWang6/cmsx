(function(){if(typeof(FD.SWFStore)!="undefined"){return}FD.SWFStore=(function(){var a=new YAHOO.util.EventProvider();a.createEvent("init");a.createEvent("securityError");a.createEvent("error");a.createEvent("engineReady");a.createEvent("dataChange");return{Event:a,ready:false,config:{swfUrl:"http://img.china.alibaba.com/swfapp/swfstore/swfstore.swf",local_path:"/",start_delay:500,write_mode:false},init:function(b){this.config=FD.common.applyIf(b||{},this.config);this._initEngine();this.Event.fireEvent("init")},setItem:function(d,c){if(this.ready){var b=this._getFlash().setItem(d,c);this._fireEvent("dataChange",{key:d,value:c});return b}else{this._dataProxy[d]=c;this.init()}},getItem:function(b){if(this.ready){return this._getFlash().getValueOf(b)}else{throw new Error("SWFStore engine is not ready yet.")}},removeItem:function(c){if(this.ready){var b=false;try{b=this._getFlash().removeItem(c)}catch(d){}this._fireEvent("dataChange",{key:c,value:null});return b}else{this._dataProxy[c]=this._deleteFlag;this.init()}},clear:function(){var b=this._getFlash().clear();this._fireEvent("dataChange");return b},getLength:function(){return this._getFlash().getLength()},key:function(b){return this._getFlash().getNameAt(b)},on:function(){return this.Event.subscribe.apply(this.Event,arguments)},isAvailable:function(){return FD.widget.Flash&&swfobject.hasFlashPlayerVersion("9")},_swf:null,_deleteFlag:{},_dataProxy:{},_initEngine:function(){var b,c={width:"1",height:"1",url:this.config.swfUrl,id:"storageSwf",flashvars:{localPath:this.config.local_path,startDelay:this.config.start_delay,allowedDomain:location.hostname},insert:false,allowScriptAccess:"always"};if(this.config.write_mode){b=new FD.widget.Flash(null,c);b.write()}else{var d=document.createElement("div");d.innerHTML='<span id="storageSwf"></span>';$D.setStyle(d,"width","1px");$D.setStyle(d,"height","1px");$D.setStyle(d,"position","absolute");$D.setStyle(d,"left","0");$D.setStyle(d,"top","0");document.body.appendChild(d);b=FD.widget.Flash.init("storageSwf",c)}this._swf=b;b.on("ALLEVENT",this._swfEventHandler,this);if(this._TRIGGER){clearTimeout(this._TRIGGER)}this._TRIGGER=setTimeout(function(){FD.SWFStore._onTimeout()},FD.SWFStore.TIMEOUT)},_getFlash:function(){return this._swf.getFlash()},_swfEventHandler:function(b){switch(b.type){case"contentReady":this._onEngineReady();break;default:this._fireEvent(b.type,b)}},_onTimeout:function(){delete this._TRIGGER;this._fireEvent("error")},_onEngineReady:function(){if(this._TRIGGER){clearTimeout(this._TRIGGER);delete this._TRIGGER}this.ready=true;this._fireEvent("engineReady");for(var c in this._dataProxy){var b=this._dataProxy[c];if(b==Object.prototype[c]){continue}else{if(b==this._deleteFlag){this.removeItem(c)}else{this.setItem(c,b)}}delete this._dataProxy[c]}},_fireEvent:function(c,b){return this.Event.fireEvent(c,b)}}})();FD.SWFStore.TIMEOUT=10000;FD.SWFStore.EventHandler=function(b,a){a.swfid=b;FD.widget.Flash.eventHandler(a)}})();
